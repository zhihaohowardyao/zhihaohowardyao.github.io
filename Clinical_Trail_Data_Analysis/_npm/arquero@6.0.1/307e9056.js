/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/arquero@6.0.1/src/index-browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{parse as t}from"../acorn@8.12.1/9e2c2538.js";import{Table as e,tableFromIPC as n,tableToIPC as r,Data as s,Vector as a,makeBuilder as o,Type as i,DataType as u,Utf8 as c,Uint64 as l,Uint32 as f,Uint16 as d,Uint8 as m,TimeSecond as h,TimeNanosecond as p,TimeMillisecond as g,TimeMicrosecond as y,Null as v,IntervalYearMonth as w,IntervalDayTime as _,Int64 as b,Int32 as x,Int16 as M,Int8 as $,Float64 as E,Float32 as A,Float16 as j,Dictionary as k,DateMillisecond as N,DateDay as S,Bool as O,Binary as T,Field as C,FixedSizeList as I,List as U,Struct as D}from"../apache-arrow@17.0.0/169cdc0a.js";const F=2147483648;class R{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let e=0;for(let n=0;n<t;++n)for(let t=this._bits[n];t;++e)t&=t-1;return e}get(t){return this._bits[t>>5]&F>>>t}set(t){this._bits[t>>5]|=F>>>t}clear(t){this._bits[t>>5]&=~(F>>>t)}scan(t){for(let e=this.next(0);e>=0;e=this.next(e+1))t(e)}next(t){const e=this._bits,n=e.length;let r=t>>5,s=e[r]&4294967295>>>t;for(;r<n;s=e[++r])if(0!==s)return(r<<5)+Math.clz32(s);return-1}nth(t){let e=this.next(0);for(;t--&&e>=0;)e=this.next(e+1);return e}not(){const t=this._bits,e=t.length;for(let n=0;n<e;++n)t[n]=~t[n];const n=this._size%32;return n&&(t[e-1]&=F>>n-1),this}and(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]&=n[t]}return this}or(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]|=n[t]}return this}}var z=void 0,q=Array.isArray;const P=Object.getPrototypeOf(Int8Array);function B(t){return t instanceof P}function L(t){return q(t)||B(t)}function V(t){return"string"==typeof t}function G(t){return null!=t&&t==t}const H=t=>L(t)||V(t);var W={compact:t=>L(t)?t.filter((t=>G(t))):t,concat:(...t)=>[].concat(...t),includes:(t,e,n)=>!!H(t)&&t.includes(e,n),indexof:(t,e)=>H(t)?t.indexOf(e):-1,join:(t,e)=>L(t)?t.join(e):z,lastindexof:(t,e)=>H(t)?t.lastIndexOf(e):-1,length:t=>H(t)?t.length:0,pluck:(t,e)=>L(t)?t.map((t=>G(t)?t[e]:z)):z,reverse:t=>L(t)?t.slice().reverse():V(t)?t.split("").reverse().join(""):z,slice:(t,e,n)=>H(t)?t.slice(e,n):z};function J(t,e,n="0"){const r=t+"",s=r.length;return s<e?Array(e-s+1).join(n)+r:r}const Y=t=>(t<10?"0":"")+t,Q=t=>t<0?"-"+J(-t,6):t>9999?"+"+J(t,6):J(t,4);function Z(t,e,n,r,s,a,o,i,u){const c=i?"Z":"";return Q(t)+"-"+Y(e+1)+"-"+Y(n)+(!u||o?"T"+Y(r)+":"+Y(s)+":"+Y(a)+"."+J(o,3)+c:a?"T"+Y(r)+":"+Y(s)+":"+Y(a)+c:s||r||!i?"T"+Y(r)+":"+Y(s)+c:"")}function K(t,e){return isNaN(t)?"Invalid Date":Z(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function X(t,e){return isNaN(t)?"Invalid Date":Z(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const tt=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function et(t){return t.match(tt)&&!isNaN(Date.parse(t))}const nt=864e5,rt=6048e5,st=new Date,at=new Date,ot=t=>(st.setTime("string"==typeof t?function(t,e=Date.parse){return et(t)?e(t):t}(t):t),st);var it={format_date:(t,e)=>K(ot(t),!e),format_utcdate:(t,e)=>X(ot(t),!e),now:Date.now,timestamp:t=>+ot(t),datetime:function(t,e,n,r,s,a,o){return arguments.length?new Date(t,e||0,null==n?1:n,r||0,s||0,a||0,o||0):new Date(Date.now())},year:t=>ot(t).getFullYear(),quarter:t=>Math.floor(ot(t).getMonth()/3),month:t=>ot(t).getMonth(),week:function(t,e){const n=e||0;at.setTime(+t),at.setDate(at.getDate()-(at.getDay()+7-n)%7),at.setHours(0,0,0,0),st.setTime(+t),st.setMonth(0),st.setDate(1),st.setDate(1-(st.getDay()+7-n)%7),st.setHours(0,0,0,0);const r=6e4*(at.getTimezoneOffset()-st.getTimezoneOffset());return Math.floor((+at-+st+1-r)/rt)},date:t=>ot(t).getDate(),dayofyear:function(t){at.setTime(+t),at.setHours(0,0,0,0),st.setTime(+at),st.setMonth(0),st.setDate(1);const e=6e4*(at.getTimezoneOffset()-st.getTimezoneOffset());return Math.floor(1+(+at-+st-e)/nt)},dayofweek:t=>ot(t).getDay(),hours:t=>ot(t).getHours(),minutes:t=>ot(t).getMinutes(),seconds:t=>ot(t).getSeconds(),milliseconds:t=>ot(t).getMilliseconds(),utcdatetime:function(t,e,n,r,s,a,o){return arguments.length?new Date(Date.UTC(t,e||0,null==n?1:n,r||0,s||0,a||0,o||0)):new Date(Date.now())},utcyear:t=>ot(t).getUTCFullYear(),utcquarter:t=>Math.floor(ot(t).getUTCMonth()/3),utcmonth:t=>ot(t).getUTCMonth(),utcweek:function(t,e){const n=e||0;return at.setTime(+t),at.setUTCDate(at.getUTCDate()-(at.getUTCDay()+7-n)%7),at.setUTCHours(0,0,0,0),st.setTime(+t),st.setUTCMonth(0),st.setUTCDate(1),st.setUTCDate(1-(st.getUTCDay()+7-n)%7),st.setUTCHours(0,0,0,0),Math.floor((+at-+st+1)/rt)},utcdate:t=>ot(t).getUTCDate(),utcdayofyear:function(t){at.setTime(+t),at.setUTCHours(0,0,0,0);const e=Date.UTC(at.getUTCFullYear(),0,1);return Math.floor(1+(+at-e)/nt)},utcdayofweek:t=>ot(t).getUTCDay(),utchours:t=>ot(t).getUTCHours(),utcminutes:t=>ot(t).getUTCMinutes(),utcseconds:t=>ot(t).getUTCSeconds(),utcmilliseconds:t=>ot(t).getUTCMilliseconds()};function ut(t){return t instanceof Date}function ct(t){return t instanceof RegExp}function lt(t){return t===Object(t)}function ft(t,e){return null!=t&&null!=e&&t==t&&e==e&&(t===e||(ut(t)||ut(e)?+t==+e:ct(t)&&ct(e)?t+""==e+"":!(!lt(t)||!lt(e))&&function(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return dt(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(n.sort(),r.sort(),!dt(n,r,((t,e)=>t===e)))return!1;const s=n.length;for(let r=0;r<s;++r){const s=n[r];if(!ft(t[s],e[s]))return!1}return!0}(t,e)))}function dt(t,e,n=ft){const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;++s)if(!n(t[s],e[s]))return!1;return!0}var mt={parse_json:t=>JSON.parse(t),to_json:t=>JSON.stringify(t)};let ht=Math.random;function pt(){return ht()}function gt(t){ht=G(t)&&isFinite(t=+t)?function(t){const e=1664525,n=1013904223,r=1/4294967296;return t=0|(0<=t&&t<1?t/r:Math.abs(t)),()=>r*((t=e*t+n|0)>>>0)}(t):Math.random}var yt={random:pt,is_nan:Number.isNaN,is_finite:Number.isFinite,abs:Math.abs,cbrt:Math.cbrt,ceil:Math.ceil,clz32:Math.clz32,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,fround:Math.fround,greatest:Math.max,least:Math.min,log:Math.log,log10:Math.log10,log1p:Math.log1p,log2:Math.log2,pow:Math.pow,round:Math.round,sign:Math.sign,sqrt:Math.sqrt,trunc:Math.trunc,degrees:t=>180*t/Math.PI,radians:t=>Math.PI*t/180,acos:Math.acos,acosh:Math.acosh,asin:Math.asin,asinh:Math.asinh,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,cos:Math.cos,cosh:Math.cosh,sin:Math.sin,sinh:Math.sinh,tan:Math.tan,tanh:Math.tanh},vt=Object.hasOwn;function wt(t){return t instanceof Map}function _t(t){return wt(t)||function(t){return t instanceof Set}(t)}function bt(t){return Array.from(t)}var xt={has:(t,e)=>_t(t)?t.has(e):null!=t&&vt(t,`${e}`),keys:t=>wt(t)?bt(t.keys()):null!=t?Object.keys(t):[],values:t=>_t(t)?bt(t.values()):null!=t?Object.values(t):[],entries:t=>_t(t)?bt(t.entries()):null!=t?Object.entries(t):[],object:t=>t?Object.fromEntries(t):z};function Mt(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=0|Math.max(0,Math.ceil((e-t)/n));const s=new Array(r);for(let e=0;e<r;++e)s[e]=t+e*n;return s}var $t={bin:function(t,e,n,r,s){return null==t?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(s||0)))},equal:ft,recode:function(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else{const n=`${t}`;if(vt(e,n))return e[n]}return void 0!==n?n:t},sequence:Mt,...W,...it,...mt,...yt,...xt,...{parse_date:t=>null==t?t:new Date(t),parse_float:t=>null==t?t:Number.parseFloat(t),parse_int:(t,e)=>null==t?t:Number.parseInt(t,e),endswith:(t,e,n)=>null!=t&&String(t).endsWith(e,n),match:(t,e,n)=>{const r=null==t?t:String(t).match(e);return null==n||null==r?r:"number"==typeof n?r[n]:r.groups?r.groups[n]:null},normalize:(t,e)=>null==t?t:String(t).normalize(e),padend:(t,e,n)=>null==t?t:String(t).padEnd(e,n),padstart:(t,e,n)=>null==t?t:String(t).padStart(e,n),upper:t=>null==t?t:String(t).toUpperCase(),lower:t=>null==t?t:String(t).toLowerCase(),repeat:(t,e)=>null==t?t:String(t).repeat(e),replace:(t,e,n)=>null==t?t:String(t).replace(e,String(n)),split:(t,e,n)=>null==t?[]:String(t).split(e,n),startswith:(t,e,n)=>null!=t&&String(t).startsWith(e,n),substring:(t,e,n)=>null==t?t:String(t).substring(e,n),trim:t=>null==t?t:String(t).trim()}};function Et(t){return null!=t?q(t)?t:[t]:[]}function At(t){return"bigint"==typeof t}function jt(t){return void 0===t?t+"":At(t)?t+"n":JSON.stringify(t)}class kt{constructor(t,e,n){this.name=t,this.fields=e,this.params=n}toString(){const t=[...this.fields.map((t=>`d[${jt(t)}]`)),...this.params.map(jt)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}}function Nt(t,e=[],n=[]){return new kt(t,Et(e),Et(n))}const St=t=>Nt("any",t),Ot=()=>Nt("count"),Tt=t=>Nt("array_agg",t),Ct=t=>Nt("array_agg_distinct",t),It=(t,e)=>Nt("map_agg",[t,e]),Ut=(t,e)=>Nt("object_agg",[t,e]),Dt=(t,e)=>Nt("entries_agg",[t,e]);var Ft={...$t,row_object:(...t)=>Nt("row_object",null,t.flat()),count:Ot,any:St,array_agg:Tt,array_agg_distinct:Ct,object_agg:Ut,map_agg:It,entries_agg:Dt,valid:t=>Nt("valid",t),invalid:t=>Nt("invalid",t),distinct:t=>Nt("distinct",t),mode:t=>Nt("mode",t),sum:t=>Nt("sum",t),product:t=>Nt("product",t),mean:t=>Nt("mean",t),average:t=>Nt("average",t),variance:t=>Nt("variance",t),variancep:t=>Nt("variancep",t),stdev:t=>Nt("stdev",t),stdevp:t=>Nt("stdevp",t),min:t=>Nt("min",t),max:t=>Nt("max",t),quantile:(t,e)=>Nt("quantile",t,e),median:t=>Nt("median",t),covariance:(t,e)=>Nt("covariance",[t,e]),covariancep:(t,e)=>Nt("covariancep",[t,e]),corr:(t,e)=>Nt("corr",[t,e]),bins:(t,e,n,r,s)=>Nt("bins",t,[e,n,r,s]),row_number:()=>Nt("row_number"),rank:()=>Nt("rank"),avg_rank:()=>Nt("avg_rank"),dense_rank:()=>Nt("dense_rank"),percent_rank:()=>Nt("percent_rank"),cume_dist:()=>Nt("cume_dist"),ntile:t=>Nt("ntile",null,t),lag:(t,e,n)=>Nt("lag",t,[e,n]),lead:(t,e,n)=>Nt("lead",t,[e,n]),first_value:t=>Nt("first_value",t),last_value:t=>Nt("last_value",t),nth_value:(t,e)=>Nt("nth_value",t,e),fill_down:(t,e)=>Nt("fill_down",t,e),fill_up:(t,e)=>Nt("fill_up",t,e)};function Rt(t,e){throw Error(t,{cause:e})}class zt{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(t){return{}}add(t,e,n){}rem(t,e,n){}write(t,e,n){}}function qt(t){const e=typeof t;return"string"===e?`"${t}"`:"object"===e&&t?ut(t)?+t:q(t)||B(t)?`[${t.map(qt)}]`:ct(t)?t+"":function(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${qt(t[r])}`;return e+="}",e}(t):t}function Pt(t,e){const n=t.length;return 1===n?(e,n)=>qt(t[0](e,n)):(r,s)=>{let a="";for(let o=0;o<n;++o){o>0&&(a+="|");const n=t[o](r,s);if(e&&(null==n||n!=n))return null;a+=qt(n)}return a}}function Bt(){}function Lt(t){return t.init=t.init||Bt,t.add=t.add||Bt,t.rem=t.rem||Bt,t}function Vt(t,e){return t.product_v=!1,t.product=e}var Gt={count:{create:()=>Lt({value:t=>t.count}),param:[]},array_agg:{create:()=>Lt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>Lt({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>Lt({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>Lt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>Lt({add:(t,e)=>{null==t.any&&(t.any=e)},value:t=>t.valid?t.any:z}),param:[1]},valid:{create:()=>Lt({value:t=>t.valid}),param:[1]},invalid:{create:()=>Lt({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=function(){const t=new Map;return{count:()=>t.size,values:()=>Array.from(t.values(),(t=>t.v)),increment(e){const n=qt(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=qt(e),r=t.get(n);1===r.n?t.delete(n):--r.n},forEach(e){t.forEach((({v:t,n:n})=>e(t,n)))}}}(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>Lt({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>Lt({value:t=>{let e=z,n=0;return t.distinct.forEach(((t,r)=>{r>n&&(n=r,e=t)})),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:z,add:(t,e)=>At(e)?0===t.sum?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>Vt(t,1),value:t=>t.valid?t.product_v?Vt(t,function(t,e=0,n=t.length){let r=t[e++];for(let s=e;s<n;++s)r*=t[s];return r}(t.list.values())):t.product:void 0,add:(t,e)=>At(e)&&1===t.product?t.product=e:t.product*=e,rem:(t,e)=>0==e||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:z,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>Lt({value:t=>t.valid?t.mean:z}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):z,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>Lt({value:t=>t.valid>1?t.dev/t.valid:z}),param:[1],req:["variance"]},stdev:{create:()=>Lt({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):z}),param:[1],req:["variance"]},stdevp:{create:()=>Lt({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):z}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=z,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===z)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=z,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===z)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>Lt({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>Lt({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):z,add:(t,e,n)=>{const r=e-t.mean_x,s=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=s/t.valid;const a=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=s*a,t.cov+=r*a},rem:(t,e,n)=>{const r=e-t.mean_x,s=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?s/t.valid:t.mean_y;const a=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=s*a,t.cov-=r*a}}),param:[2]},covariancep:{create:()=>Lt({value:t=>t.valid>1?t.cov/t.valid:z}),param:[2],req:["covariance"]},corr:{create:()=>Lt({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):z}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>Lt({value:s=>function(t,e,n=15,r=!0,s=0,a){const o=Math.LN10;if(null==a){const r=Math.ceil(Math.log(n)/o),i=e-t||Math.abs(t)||1,u=[5,2];for(a=Math.max(s,Math.pow(10,Math.round(Math.log(i)/o)-r));Math.ceil(i/a)>n;)a*=10;const c=u.length;for(let t=0;t<c;++t){const e=a/u[t];e>=s&&i/e<=n&&(a=e)}}if(r){let n=Math.log(a);const r=n>=0?0:1+~~(-n/o),s=Math.pow(10,-r-1);n=Math.floor(t/a+s)*a,t=t<n?n-a:n,e=Math.ceil(e/a)*a}return[t,e===t?t+a:e,a]}(s.min,s.max,t,e,n,r)}),param:[1,4],req:["min","max"]}};const Ht={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},Wt={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:s}=e;let a=n;if(t<a){for(;a+1<s&&r(a+1);)++a;t=a}return(1+t)/s}}},param:[]};var Jt={row_number:{create:()=>({init:Bt,value:t=>t.index+1}),param:[]},rank:Ht,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=Ht.create();return{init:t,value:t=>(e(t)-1)/(t.size-1)}},param:[]},cume_dist:Wt,ntile:{create(t){(t=+t)>0||Rt("ntile num must be greater than zero.");const{init:e,value:n}=Wt.create();return{init:e,value:e=>Math.ceil(t*n(e))}},param:[0,1]},lag:{create:(t,e=z)=>(t=+t||1,{init:Bt,value:(n,r)=>{const s=n.index-t;return s>=0?n.value(s,r):e}}),param:[1,2]},lead:{create:(t,e=z)=>(t=+t||1,{init:Bt,value:(n,r)=>{const s=n.index+t;return s<n.size?n.value(s,r):e}}),param:[1,2]},first_value:{create:()=>({init:Bt,value:(t,e)=>t.value(t.i0,e)}),param:[1]},last_value:{create:()=>({init:Bt,value:(t,e)=>t.value(t.i1-1,e)}),param:[1]},nth_value:{create:t=>((t=+t)>0||Rt("nth_value nth must be greater than zero."),{init:Bt,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):z}}),param:[1,1]},fill_down:{create(t=z){let e;return{init:()=>e=t,value:(t,n)=>{const r=t.value(t.index,n);return G(r)?e=r:e}}},param:[1,1]},fill_up:{create(t=z){let e,n;return{init:()=>(e=t,n=-1),value:(r,s)=>r.index<=n?e:(n=function(t,e,n){for(const r=t.size;n<r;++n)if(G(t.value(n,e)))return n;return-1}(r,s,r.index))>=0?e=r.value(n,s):(n=r.size,e=t)}},param:[1,1]}};function Yt(t){return vt(Gt,t)}function Qt(t){return vt(Jt,t)}function Zt(t){return vt($t,t)||"row_object"===t}function Kt(t){return Yt(t)&&Gt[t]}function Xt(t){return Qt(t)&&Jt[t]}function te(t,e=((t,e)=>t),n=""){const r=t.length;if(!r)return"";let s=e(t[0],0);for(let a=1;a<r;++a)s+=n+e(t[a],a);return s}function ee(t,e,...n){const r=["_","$"],s=r.slice(0,n.length);return s.push('"use strict"; const '+n.map(((t,e)=>t.map(((t,n)=>`${r[e]}${n} = ${r[e]}[${n}]`)).join(", "))).join(", ")+`; return (${t}) => ${e};`),Function(...s)(...n)}function ne(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function re(t){return At(t)?t:+t}class se{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:function(t,e=0,n=t.length){let r=n?t[e++]:z;for(let s=e;s<n;++s)r>t[s]&&(r=t[s]);return r}(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:function(t,e=0,n=t.length){let r=n?t[e++]:z;for(let s=e;s<n;++s)r<t[s]&&(r=t[s]);return r}(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(ne)),function(t,e){const n=t.length;if(!n)return z;if((e=+e)<=0||n<2)return re(t[0]);if(e>=1)return re(t[n-1]);const r=(n-1)*e,s=Math.floor(r),a=re(t[s]);return At(a)?a:a+(re(t[s+1])-a)*(r-s)}(this._sorted,t)}}const ae=(t,e,n)=>ee(e,"{"+te(t,((t,r)=>`_${r}.${n}(${e});`))+"}",t);function oe(t,e){const{ops:n,output:r}=function(t,e){const n={},r=[];function s(t,a=[]){const o=t+":"+a;if(n[o])return n[o];const i=Kt(t),u=i.create(...a);return e<0&&i.stream&&i.stream.forEach((t=>s(t,[]))),i.req&&i.req.forEach((t=>s(t,[]))),n[o]=u,r.push(u),u}const a=t.map((t=>{const e=s(t.name,t.params);return e.output=t.id,e}));return{ops:r,output:a}}(t,e),s=t[0].fields,a=s.length;return new(0===a?ie:1===a?ue:2===a?ce:Rt("Unsupported field count: "+a))(s,n,r,e)}class ie extends zt{constructor(t,e,n,r){super(n),this._op=e,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach((e=>e.init(t))),t.values&&(t.list=new se),t}write(t,e,n){const r=this._outputs,s=r.length;for(let a=0;a<s;++a)e[r[a].output][n]=r[a].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class ue extends ie{constructor(t,e,n,r){super(t,e,n,r);const s=["state","v1","v2"];this._add=ae(e,s,"add"),this._rem=ae(e,s,"rem")}add(t,e,n){const r=this._fields[0](e,n);++t.count,G(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,e,n){const r=this._fields[0](e,n);--t.count,G(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class ce extends ie{constructor(t,e,n,r){super(t,e,n,r);const s=["state","v1","v2"];this._add=ae(e,s,"add"),this._rem=ae(e,s,"rem")}add(t,e,n){const r=this._fields[0](e,n),s=this._fields[1](e,n);++t.count,G(r)&&G(s)&&(++t.valid,t.list&&t.list.add([r,s]),this._add(t,r,s))}rem(t,e,n){const r=this._fields[0](e,n),s=this._fields[1](e,n);--t.count,G(r)&&G(s)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,s))}}function le(t){return"function"==typeof t}function fe(t,e){const n=Array(t);if(le(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}function de(t,e,n){if(e.length){const r=t.data(),{keys:s}=t.groups()||{},a=me(t,e),o=s?(t,e)=>a[t][s[e]]:t=>a[t][0];n=n.map((t=>e=>t(e,r,o)))}return n}function me(t,e,n){if(!e.length)return n;const r=he(e),s=t.groups(),a=s?s.size:1;return n=n||fe(e.length,(()=>Array(a))),a>1?r.forEach((e=>{const r=ge(t,e,s);for(let t=0;t<a;++t)e.write(r[t],n,t)})):r.forEach((e=>{const r=pe(t,e);e.write(r,n,0)})),n}function he(t,e){const n=[],r={};for(const e of t){const t=e.fields.map((t=>t+"")).join(",");(r[t]||(r[t]=[])).push(e)}for(const t in r)n.push(oe(r[t],e));return n}function pe(t,e){const n=e.init(),r=t.totalRows(),s=t.data(),a=t.mask();if(t.isOrdered()){const a=t.indices();for(let t=0;t<r;++t)e.add(n,a[t],s)}else if(a)for(let t=a.next(0);t>=0;t=a.next(t+1))e.add(n,t,s);else for(let t=0;t<r;++t)e.add(n,t,s);return n}function ge(t,e,n){const{keys:r,size:s}=n,a=fe(s,(()=>e.init())),o=t.data();if(t.isOrdered()){const n=t.indices(),s=n.length;for(let t=0;t<s;++t){const s=n[t];e.add(a[r[s]],s,o)}}else if(t.isFiltered()){const n=t.mask();for(let t=n.next(0);t>=0;t=n.next(t+1))e.add(a[r[t]],t,o)}else{const n=t.totalRows();for(let t=0;t<n;++t)e.add(a[r[t]],t,o)}return a}function ye(t,e){const{get:n,names:r,rows:s,size:a}=e,o=r.length;for(let e=0;e<o;++e){const o=t.add(r[e],Array(a)),i=n[e];for(let t=0;t<a;++t)o[t]=i(s[t])}}const ve="ArrowFunctionExpression",we="FunctionExpression",_e="Identifier",be="Literal",xe="MemberExpression",Me="ObjectExpression",$e="ObjectPattern",Ee="Property",Ae="Column",je="Constant",ke="Dictionary",Ne="Parameter";function Se(t,e,n,r){const s=n[t.type]||n.Default;if(s&&!1===s(t,e,r))return;const a=Fe[t.type];a&&a(t,e,n)}const Oe=(t,e,n)=>{Se(t.argument,e,n,t)},Te=(t,e,n)=>{Se(t.left,e,n,t),Se(t.right,e,n,t)},Ce=(t,e,n)=>{Se(t.test,e,n,t),Se(t.consequent,e,n,t),t.alternate&&Se(t.alternate,e,n,t)},Ie=(t,e,n)=>{De(t.params,e,n,t),Se(t.body,e,n,t)},Ue=(t,e,n)=>{Se(t.callee,e,n,t),De(t.arguments,e,n,t)},De=(t,e,n,r)=>{t.forEach((t=>Se(t,e,n,r)))},Fe={TemplateLiteral:(t,e,n)=>{De(t.expressions,e,n,t),De(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{Se(t.object,e,n,t),Se(t.property,e,n,t)},CallExpression:Ue,NewExpression:Ue,ArrayExpression:(t,e,n)=>{De(t.elements,e,n,t)},AssignmentExpression:Te,AwaitExpression:Oe,BinaryExpression:Te,LogicalExpression:Te,UnaryExpression:Oe,UpdateExpression:Oe,ConditionalExpression:Ce,ObjectExpression:(t,e,n)=>{De(t.properties,e,n,t)},Property:(t,e,n)=>{Se(t.key,e,n,t),Se(t.value,e,n,t)},ArrowFunctionExpression:Ie,FunctionExpression:Ie,FunctionDeclaration:Ie,VariableDeclaration:(t,e,n)=>{De(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{Se(t.id,e,n,t),Se(t.init,e,n,t)},SpreadElement:(t,e,n)=>{Se(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{De(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{Se(t.expression,e,n,t)},IfStatement:Ce,ForStatement:(t,e,n)=>{Se(t.init,e,n,t),Se(t.test,e,n,t),Se(t.update,e,n,t),Se(t.body,e,n,t)},WhileStatement:(t,e,n)=>{Se(t.test,e,n,t),Se(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{Se(t.body,e,n,t),Se(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{Se(t.discriminant,e,n,t),De(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&Se(t.test,e,n,t),De(t.consequent,e,n,t)},ReturnStatement:Oe,Program:(t,e,n)=>{Se(t.body[0],e,n,t)}};function Re(t){delete t.start,delete t.end,delete t.optional}function ze(t){Re(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function qe(t,e){return e&&e.type===t}const Pe=(t,e)=>{const n=Je[t.type];return n?n(t,e):Rt(`Unsupported expression construct: ${t.type}`)},Be=(t,e)=>"("+Pe(t.left,e)+" "+t.operator+" "+Pe(t.right,e)+")",Le=(t,e)=>"("+Ge(t.params,e)+")=>"+Pe(t.body,e),Ve=(t,e)=>Pe(t.callee,e)+"("+Ge(t.arguments,e)+")",Ge=(t,e,n=",")=>t.map((t=>Pe(t,e))).join(n),He=t=>t.computed?`[${jt(t.name)}]`:`.${t.name}`,We=(t,e,n)=>{const r=t.table||"";return`data${r}${He(t)}.${n}(${e.index}${r})`},Je={Constant:t=>t.raw,Column:(t,e)=>t.array?((t,e)=>{const n=t.table||"";return`data${n}${He(t)}[${e.index}${n}]`})(t,e):We(t,e,"at"),Dictionary:(t,e)=>We(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${He(t)}`,Op:(t,e)=>`op(${jt(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,s=r.length;let a=n[0].value.raw;for(let t=0;t<s;)a+="${"+Pe(r[t],e)+"}"+n[++t].value.raw;return"`"+a+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=Pe(t.object,e),s=Pe(t.property,e);return r+(n?"."+s:"["+s+"]")},CallExpression:Ve,NewExpression:(t,e)=>"new "+Ve(t,e),ArrayExpression:(t,e)=>"["+Ge(t.elements,e)+"]",AssignmentExpression:Be,BinaryExpression:Be,LogicalExpression:Be,UnaryExpression:(t,e)=>"("+t.operator+Pe(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+Pe(t.test,e)+"?"+Pe(t.consequent,e)+":"+Pe(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+Ge(t.properties,e)+"})",Property:(t,e)=>{const n=Pe(t.key,e);return(t.computed?`[${n}]`:n)+":"+Pe(t.value,e)},ArrowFunctionExpression:Le,FunctionExpression:Le,FunctionDeclaration:Le,ArrayPattern:(t,e)=>"["+Ge(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+Ge(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+Ge(t.declarations,e,","),VariableDeclarator:(t,e)=>Pe(t.id,e)+"="+Pe(t.init,e),SpreadElement:(t,e)=>"..."+Pe(t.argument,e),BlockStatement:(t,e)=>"{"+Ge(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>Pe(t.expression,e),IfStatement:(t,e)=>"if ("+Pe(t.test,e)+")"+Pe(t.consequent,e)+(t.alternate?" else "+Pe(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+Pe(t.discriminant,e)+") {"+Ge(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+Pe(t.test,e):"default")+": "+Ge(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+Pe(t.argument,e),Program:(t,e)=>Pe(t.body[0],e)};function Ye(t,e={index:"row"}){return Pe(t,e)}function Qe(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}var Ze={escape:(t,e,n)=>Qe(t,e,n),expr:(t,e)=>Qe(`(row,data,op)=>${t}`,$t,e),expr2:(t,e)=>Qe(`(row0,data0,row,data)=>${t}`,$t,e),join:(t,e)=>Qe(`(row1,data1,row2,data2)=>${t}`,$t,e),param:(t,e)=>Qe(t,$t,e)};function Ke(t){return q(t)?t:wt(t)?t.entries():t?Object.entries(t):[]}const Xe={"==":1,"!=":1,"===":1,"!==":1};function tn(t,e,n=0,r=void 0,s=void 0){if(t.type=Ae,t.name=e,t.table=n,L(r)&&(t.array=!0),s&&r&&le(r.keyFor)){const e=Xe[s.operator]?s.left===t?s.right:s.left:s.callee&&"equal"===s.callee.name?s.arguments[s.arguments[0]===t?1:0]:null;e&&e.type===be&&function(t,e,n,r){r<0?(t.type=be,t.value=!1,t.raw="false"):(e.type=ke,n.value=r,n.raw=r+"")}(s,t,e,r.keyFor(e.value))}return t}const en="row_object";function nn(t,e,n=e.columnNames()){t.type=Me;const r=t.properties=[];for(const t of Ke(n)){const[n,s]=q(t)?t:[t,t];r.push({type:Ee,key:{type:be,raw:jt(s)},value:tn({computed:!0},n,0,e.column(n))})}return t}function rn(t,e){return Ye(nn({},t,e))}function sn(t,e){return Ze.expr(rn(t,e))}const an="Escaped functions are not valid as rollup or pivot values.";function on(t,e,n){t.aggronly&&Rt(an);const r=`(row,data)=>fn(${rn(t.table)},$)`;return{escape:Ze.escape(r,(s=e.expr,le(s)?s:()=>s),n)};var s}var un={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};function cn(t){return"number"==typeof t}const ln={ecmaVersion:11},fn="$",dn="d",mn="d1",hn="d2",pn=t=>(e,n)=>n.error(e,t+" not allowed"),gn=pn("Aggregate function"),yn=pn("Window function"),vn="Invalid argument",wn="Invalid column reference",_n=wn+" (must be input to an aggregate function)",bn="Invalid function call",xn="Invalid operator parameter",Mn="Unsupported destructuring pattern",$n="Table expressions do not support closures",En="Use aq.escape(fn) to use a function as-is (including closures)",An=`\nNote: ${$n}. ${En}, or use table.params({ name: value }) to define dynamic parameters.`,jn=`\nNote: ${$n}. ${En}, or use aq.addFunction(name, fn) to add new op functions.`,kn=`The ${en} method is not valid in multi-table expressions.`;function Nn(e,n){const r=function(e){try{const n=e.field?function(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}(e):q(e)?jt(e):e;return t(`expr=(${n})`,ln).body[0].expression.right}catch(t){Rt("Expression parse error: "+(e+""))}}(n);let s=e.root=r;return e.spec=n,e.tuple=null,e.tuple1=null,e.tuple2=null,e.$param=null,e.$op=0,e.scope=new Set,e.paramsRef=new Map,e.columnRef=new Map,!function(t){return qe(we,t)||qe(ve,t)}(s)?e.join?(e.scope.add(e.tuple1=mn),e.scope.add(e.tuple2=hn),e.scope.add(e.$param=fn)):(e.scope.add(e.tuple=dn),e.scope.add(e.$param=fn)):(!function(t,e){t.generator&&pn("Generator functions")(t,e);t.async&&pn("Async functions")(t,e);const{params:n}=t,r=n.length,s=t=>(n,r)=>e.columnRef.set(n,[r,t]),a=(t,n)=>e.paramsRef.set(t,n);r&&(e.join?(Cn(e,n[0],"tuple1",s(1)),r>1&&Cn(e,n[1],"tuple2",s(2)),r>2&&Cn(e,n[2],"$param",a)):(Cn(e,n[0],"tuple",s(0)),r>1&&Cn(e,n[1],"$param",a)));e.root=t.body}(s,e),s=s.body),Se(s,e,Sn),e.root}const Sn={FunctionDeclaration:pn("Function definitions"),ForStatement:pn("For loops"),ForOfStatement:pn("For-of loops"),ForInStatement:pn("For-in loops"),WhileStatement:pn("While loops"),DoWhileStatement:pn("Do-while loops"),AwaitExpression:pn("Await expressions"),ArrowFunctionExpression:pn("Function definitions"),AssignmentExpression:pn("Assignments"),FunctionExpression:pn("Function definitions"),NewExpression:pn('Use of "new"'),UpdateExpression:pn("Update expressions"),VariableDeclarator(t,e){Ln(t.id,e)},Identifier(t,e,n){Dn(t,e,n)&&!e.scope.has(t.name)&&e.error(t,"Invalid variable reference",An)},CallExpression(t,e){const n=In(t.callee),r=Kt(n)||Xt(n);if(r){if((e.join||!1===e.aggregate)&&Yt(n)&&gn(t,e),(e.join||!1===e.window)&&Qt(n)&&yn(t,e),e.$op=1,e.ast)Bn(t,n,e),t.arguments.forEach((t=>Se(t,e,Tn)));else{const s=e.op(function(t,e,n,r){const s=[],a=[],o=e.param[0]||0,i=o+(e.param[1]||0);return r.forEach(((e,n)=>{n<o?(Se(e,t,Tn),s.push(t.field(e))):n<i?(Se(e,t,Tn),a.push(t.param(e))):t.error(e,xn)})),{name:n,fields:s,params:a,...t.spec.window||{}}}(e,r,n,t.arguments));Object.assign(t,{type:"Op",name:s.id})}return e.$op=0,!1}Zt(n)?Bn(t,n,e):e.error(t,bn,jn)},MemberExpression(t,e,n){const{object:r,property:s}=t;if(!qe(_e,r))return;const{name:a}=r;if(Un(t)&&qe(_e,s)&&vt(un,s.name))return void Pn(t,s.name);const o=a===e.tuple?0:a===e.tuple1?1:a===e.tuple2?2:-1;return o>=0?On(t,o,e,Fn,n):a===e.$param?On(t,o,e,zn):void(e.paramsRef.has(a)?qn(t,e.paramsRef.get(a)):e.columnRef.has(a)?Rn(r,a,e,t):vt(e.params,a)&&qn(r,a))}};function On(t,e,n,r,s){const{property:a,computed:o}=t;let i;if(o)if(qe(be,a))i=a.value;else try{Se(a,n,Sn,t),i=n.param(a)}catch(e){n.error(t,"Invalid member expression")}else i=a.name;return r(t,i,e,n,s),!1}const Tn={...Sn,VariableDeclarator:pn("Variable declaration in operator call"),Identifier(t,e,n){Dn(t,e,n)&&e.error(t,"Variable not accessible in operator call")},CallExpression(t,e){const n=In(t.callee);Zt(n)?Bn(t,n,e):e.error(t,bn,jn)}};function Cn(t,e,n,r){qe(_e,e)?(t.scope.add(e.name),t[n]=e.name):qe($e,e)&&e.properties.forEach((e=>{const n=qe(_e,e.key)?e.key.name:qe(be,e.key)?e.key.value:t.error(e,vn);qe(_e,e.value)||t.error(e.value,Mn),r(e.value.name,n)}))}function In(t){return qe(_e,t)?t.name:qe(xe,t)?Un(t)?function(t){return"max"===t?"greatest":"min"===t?"least":t}(t.property.name):t.property.name:null}function Un(t){return qe(_e,t.object)&&"Math"===t.object.name}function Dn(t,e,n){const{name:r}=t;if(qe(xe,n)&&n.property===t);else if(qe(Ee,n)&&n.key===t);else if(e.paramsRef.has(r))qn(t,e.paramsRef.get(r));else if(e.columnRef.has(r))Rn(t,r,e,n);else if(vt(e.params,r))qn(t,r);else{if(!vt(un,r))return!0;Pn(t,r)}}function Fn(t,e,n,r,s){const a=0===n?r.table:n>0?r.join[n-1]:null,o=a&&a.column(e);a&&!o&&r.error(t,wn),r.aggronly&&!r.$op&&r.error(t,_n),tn(t,e,n,o,s)}function Rn(t,e,n,r){const[s,a]=n.columnRef.get(e);Fn(t,s,a,n,r)}function zn(t,e,n,r){r.params&&!vt(r.params,e)&&r.error(t,"Invalid param reference"),qn(t,e)}function qn(t,e){t.type=Ne,t.name=e}function Pn(t,e){t.type=je,t.name=e,t.raw=un[e]}function Bn(t,e,n){if(e===en){const e=n.table;e||n.error(t,kn),nn(t,e,t.arguments.length?t.arguments.map((t=>{const r=n.param(t),s=cn(r)?e.columnName(r):r;return e.column(s)||n.error(t,wn),s})):e.columnNames())}else t.callee={type:"Function",name:e}}function Ln(t,e){qe(_e,t)?e.scope.add(t.name):qe("ArrayPattern",t)?t.elements.forEach((t=>Ln(t,e))):qe($e,t)?t.properties.forEach((t=>Ln(t.value,e))):e.error(t.id,"Unsupported variable declaration")}const Vn={[Ae]:1,Op:1};function Gn(t,e={}){const n=e.generate||Ye,r=e.compiler||Ze,s=function(t){return(t.table?Hn(t.table):t.join?{...Hn(t.join[1]),...Hn(t.join[0])}:{})||{}}(e),a={},o={},i=[],u=[];let c=0,l=-1;const f=e.join?r.join:1==e.index?r.expr2:r.expr,d={op(t){const e=function(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){e+=`[${t.frame.map((t=>Number.isFinite(t)?Math.abs(t):-1))},${!!t.peers}]`}return e}(t);return o[e]||(t.id=++l,o[e]=t)},field(t){const e=n(t);return a[e]||(a[e]=++c)},param:t=>qe(be,t)?t.value:r.param(n(t),s),value(t,r){i.push(t);const a=r.escape||(e.ast?(Se(o=r,null,{Column:ze,Constant:ze,Default:Re}),o):f(n(r),s));var o;u.push(a),Vn[r.type]&&a!==r&&lt(a)&&(a.field=r.name)},error(t,e,n=""){const r=t.start-6,s=t.end-6;Rt(`${e}: "${String(d.spec).slice(r,s)}"${n}`)}};Object.assign(d,e,{params:s});for(const[e,n]of Ke(t))d.value(e+"",n.escape?on(d,n,s):Nn(d,n));if(e.ast)return{names:i,exprs:u};const m=[];for(const t in a)m[a[t]]=r.expr(t,s);const h=Object.values(o);return h.forEach((t=>t.fields=t.fields.map((t=>m[t])))),{names:i,exprs:u,ops:h}}function Hn(t){return t&&le(t.params)?t.params():{}}function Wn(t,e){return t&&t.expr?new Jn({...t,...e}):new Jn(e,t)}class Jn{constructor(t,e){this.expr=e,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...le(this.expr)?{func:!0}:{}}}}function Yn(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return Wn(t,e?{expr:e,...r}:r)}function Qn(t,e){for(const[n,r]of Ke(e))t.set(n,r);return t}function Zn(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function Kn(t,e,n=new Map){return V(e=cn(e)?t.columnName(e):e)?n.set(e,e):q(e)?e.forEach((e=>Kn(t,e,n))):le(e)?Kn(t,e(t),n):lt(e)?Qn(n,e):Rt(`Invalid column selection: ${jt(e)}`),n}function Xn(t,e){return t.toObject=e,t}function tr(t){return q(t)?t.map(tr):t&&t.toObject?t.toObject():t}function er(){return Xn((t=>t.columnNames()),(()=>({all:[]})))}function nr(...t){return t=t.flat(),Xn((e=>{const n=Kn(e,t);return e.columnNames((t=>!n.has(t)))}),(()=>({not:tr(t)})))}function rr(t,e){return Xn((n=>{let r=cn(t)?t:n.columnIndex(t),s=cn(e)?e:n.columnIndex(e);if(s<r){const t=s;s=r,r=t}return n.columnNames().slice(r,s+1)}),(()=>({range:[t,e]})))}function sr(t){return V(t)&&(t=RegExp(Zn(t))),Xn((e=>e.columnNames((e=>t.test(e)))),(()=>({matches:[t.source,t.flags]})))}function ar(t){return sr(RegExp("^"+Zn(t)))}function or(t){return sr(RegExp(Zn(t)+"$"))}function ir(t,e,n,r={window:!1}){const s=new Map,a=n=>{V(n=cn(n)?e.columnName(n):n)?s.set(n,Yn(n)):le(n)?Kn(e,n).forEach(a):lt(n)?Qn(s,n):Rt(`Invalid ${t} value: ${n+""}`)};return Et(n).forEach(a),r.preparse&&r.preparse(s),Gn(s,{table:e,...r})}function ur(t,...e){return function(t,e){return t.create({groups:cr(t,e)})}(t,ir("groupby",t,e.flat()))}function cr(t,{names:e=[],exprs:n=[],ops:r=[]}){const s=e.length;if(0===s)return null;if(1===s&&!t.isFiltered()&&n[0].field){const r=t.column(n[0].field);if(r.groups)return r.groups(e)}let a=de(t,r,n);const o=Pt(a),i=t.totalRows(),u=new Uint32Array(i),c={},l=[],f=t.data(),d=t.mask();if(d)for(let t=d.next(0);t>=0;t=d.next(t+1)){const e=o(t,f)+"";u[t]=c[e]??=l.push(t)-1}else for(let t=0;t<i;++t){const e=o(t,f)+"";u[t]=c[e]??=l.push(t)-1}return r.length||(a=a.map((t=>e=>t(e,f)))),{keys:u,get:a,names:e,rows:l,size:l.length}}function lr(t){return t?new fr({...t.data()},t.columnNames()):new fr}class fr{constructor(t,e){this.data=t||{},this.names=e||[]}add(t,e){return this.has(t)||this.names.push(t+""),this.data[t]=e}has(t){return vt(this.data,t)}groupby(t){return this.groups=t,this}new(t){const{data:e,names:n,groups:r=null}=this;return t.create({data:e,names:n,groups:r,filter:null,order:null})}derive(t){return t.create(this)}}function dr(t,e){return mr(t,Gn(e,{table:t,aggronly:!0,window:!1}))}function mr(t,{names:e,exprs:n,ops:r=[]}){const s=lr(),a=t.groups();return a&&ye(s,a),function(t,e,n,r=[],s){if(!e.length)return;const a=n?n.size:1,o=(t,e)=>r[t][e],i=t.length;for(let n=0;n<i;++n){const i=e[n];if(null!=i.field)s.add(t[n],r[i.field]);else if(a>1){const e=s.add(t[n],Array(a));for(let t=0;t<a;++t)e[t]=i(t,null,o)}else s.add(t[n],[i(0,null,o)])}}(e,n,a,me(t,r),s),s.new(t)}function hr(t,...e){return pr(t,Kn(t,e.flat()))}function pr(t,e){const n=lr();return e.forEach(((e,r)=>{const s=V(e)?e:r;if(s){const e=t.column(r)||Rt(`Unrecognized column: ${r}`);n.add(s,e)}})),n.derive(t)}function gr(t,e,n,r){const s="map"===r||!0===r?It:"entries"===r?Dt:"object"===r?Ut:Rt('groups option must be "map", "entries", or "object".'),{names:a}=t.groups(),o=function(t,e){t=_t(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}(t.columnNames(),"_");let i=hr(t,{}).reify(e).create({data:{[o]:n}});i=dr(i,{[o]:Tt(o)});for(let t=a.length;--t>=0;)i=dr(ur(i,a.slice(0,t)),{[o]:s(a[t],o)});return i.get(o)}class yr{constructor(t,e,n,r,s,a){const o=Object.freeze({...t}),i=(e=e?.slice()??Object.keys(o)).length?o[e[0]].length:0;this._names=Object.freeze(e),this._data=o,this._total=i,this._nrows=n?.count()??i,this._mask=n??null,this._group=r??null,this._order=s??null,this._params=a,this._index=null,this._partitions=null}create({data:t,names:e,filter:n,groups:r,order:s}={}){const a=void 0!==n?n:this.mask();return new this.constructor(t||this._data,e||(t?null:this._names),a,void 0!==r?r:function(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:s}=t,a=new Uint32Array(s);e.scan((t=>a[n[t]]=1));const o=a.reduce(((t,e)=>t+e),0);if(o===s)return t;const i=Array(o);let u=0;for(let t=0;t<s;++t)a[t]&&(i[a[t]=u++]=r[t]);const c=new Uint32Array(n.length);return e.scan((t=>c[t]=a[n[t]])),{...t,keys:c,rows:i,size:u}}(this._group,n&&a),void 0!==s?s:this._order,this._params)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows(),e=this.numCols(),n=t=>1!==t?"s":"";return`Table: ${e} col${n(e)} x ${t} row${n(t)}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,e=Array){const n=this.column(t),r=new e(this.numRows());let s=-1;return this.scan((t=>r[++s]=n.at(t)),!0),r}get(t,e=0){const n=this.column(t);return this.isFiltered()||this.isOrdered()?n.at(this.indices()[e]):n.at(e)}getter(t){const e=this.column(t),n=this.isFiltered()||this.isOrdered()?this.indices():null;return n?t=>e.at(n[t]):e?t=>e.at(t):void Rt(`Unrecognized column: ${t}`)}object(t=0){return vr(this)(t)}objects(t={}){const{grouped:e,limit:n,offset:r}=t,s=sn(this,Kn(this,t.columns||er())),a=[];if(this.scan(((t,e)=>a.push(s(t,e))),!0,n,r),e&&this.isGrouped()){const t=[];return this.scan((e=>t.push(e)),!0,n,r),gr(this,t,a,e)}return a}*[Symbol.iterator](){const t=vr(this),e=this.numRows();for(let n=0;n<e;++n)yield t(n)}*values(t){const e=this.getter(t),n=this.numRows();for(let t=0;t<n;++t)yield e(t)}print(t={}){const e=cn(t)?{limit:+t}:{...t,limit:10},n=this.objects({...e,grouped:!1}),r=`${this[Symbol.toStringTag]}. Showing ${n.length} rows.`;return console.log(r),console.table(n),this}indices(t=!0){if(this._index)return this._index;const e=this.numRows(),n=new Uint32Array(e),r=this.isOrdered(),s=this.mask();let a=-1;if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))n[++a]=t;else for(let t=0;t<e;++t)n[++a]=t;if(t&&r){const{_order:t,_data:e}=this;n.sort(((n,r)=>t(n,r,e)))}return!t&&r||(this._index=n),n}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:e,size:n}=this._group,r=fe(n,(()=>[])),s=this._index,a=this.mask(),o=this.numRows();if(s&&this.isOrdered())for(let t,n=0;n<o;++n)t=s[n],r[e[t]].push(t);else if(a)for(let t=a.next(0);t>=0;t=a.next(t+1))r[e[t]].push(t);else for(let t=0;t<o;++t)r[e[t]].push(t);if(t&&!s&&this.isOrdered()){const t=this._order,e=this._data;for(let s=0;s<n;++s)r[s].sort(((n,r)=>t(n,r,e)))}return!t&&this.isOrdered()||(this._partitions=r),r}reify(t){const e=t?t.length:this.numRows(),n=this._names;let r,s;if(!t&&!this.isOrdered()){if(!this.isFiltered())return this;e===this.totalRows()&&(r=this.data())}if(!r){const o=t?e=>t.forEach(e):t=>this.scan(t,!0),i=n.length;r={};for(let t=0;t<i;++t){const s=n[t],i=this.column(s),u=r[s]=new(B(a=i)?a.constructor:Array)(e);let c=-1;L(i)?o((t=>u[++c]=i[t])):o((t=>u[++c]=i.at(t)))}this.isGrouped()&&(s=function(t,e,n,r){const{keys:s,rows:a,size:o}=t;let i=a,u=o,c=null;if(n){c=new Int32Array(o),e((t=>c[s[t]]=1));const t=c.reduce(((t,e)=>t+e),0);if(t!==o){i=Array(t),u=0;for(let t=0;t<o;++t)c[t]&&(i[c[t]=u++]=a[t])}}let l=-1;const f=new Uint32Array(r);return e(u!==o?t=>f[++l]=c[s[t]]:t=>f[++l]=s[t]),{...t,keys:f,rows:i,size:u}}(this.groups(),o,!!t,e))}var a;return this.create({data:r,names:n,groups:s,filter:null,order:null})}scan(t,e,n=1/0,r=0){const s=this._mask,a=this._nrows,o=this._data;let i=r||0;if(i>a)return;const u=Math.min(a,i+n),c=()=>i=this._total;if(e&&this.isOrdered()||s&&this._index){const e=this.indices(),n=this._data;for(;i<u;++i)t(e[i],n,c)}else if(s){let e=u-i+1;for(i=s.nth(i);--e&&i>-1;i=s.next(i+1))t(i,o,c)}else for(;i<u;++i)t(i,o,c)}}function vr(t){let e=t._builder;if(!e){const n=sn(t),r=t.data();if(t.isOrdered()||t.isFiltered()){const s=t.indices();e=t=>n(s[t],r)}else e=t=>n(t,r);t._builder=e}return e}function wr(t,...e){e=e.flat();const n=t.numRows(),r=n+e.reduce(((t,e)=>t+e.numRows()),0);if(n===r)return t;const s=[t,...e],a=lr();return t.columnNames().forEach((t=>{const e=Array(r);let n=0;s.forEach((r=>{const s=r.column(t)||{at:()=>z};r.scan((t=>e[n++]=s.at(t)))})),a.add(t,e)})),a.new(t)}function _r(t,e,{before:n,after:r}={}){const s=null!=n,a=null!=r;s||a||Rt("relocate requires a before or after option."),s&&a&&Rt("relocate accepts only one of the before or after options."),e=Kn(t,e);const o=[...Kn(t,s?n:r).keys()],i=s?o[0]:o.pop(),u=new Map;return t.columnNames().forEach((t=>{const n=!e.has(t);if(t===i){a&&n&&u.set(t,t);for(const[t,n]of e)u.set(t,n);if(a)return}n&&u.set(t,t)})),pr(t,u)}function br(t){return{left(e,n,r,s){for(null==r&&(r=0),null==s&&(s=e.length);r<s;){const a=r+s>>>1;t(e[a],n)<0?r=a+1:s=a}return r},right(e,n,r,s){for(null==r&&(r=0),null==s&&(s=e.length);r<s;){const a=r+s>>>1;t(e[a],n)>0?s=a:r=a+1}return r}}}const xr=br(ne);const Mr=t=>(t.frame||[null,null]).map((t=>Number.isFinite(t)?Math.abs(t):null)),$r=t=>!!t.peers;function Er(t,e,n,r={},s){const a=t.data(),o=function(t,e){const n={};return t.forEach((t=>{const e=Mr(t),r=$r(t),s=`${e},${r}`,{aggOps:a,winOps:o}=n[s]||(n[s]={frame:e,peers:r,aggOps:[],winOps:[]});Yt(t.name)?a.push(t):o.push(function(t){const{id:e,name:n,fields:r=[],params:s=[]}=t;return{...Xt(n).create(...s),get:r.length?r[0]:null,id:e}}(t))})),Object.values(n).map((t=>function(t,e,n,r,s){let a,o,i,u,c;const l=t=>o[t-1]===o[t],f=r.length,d=s.length,m=r.length?ee(["w","r","k"],"{"+te(r,((t,e)=>`r[_${e}.id][k]=_${e}.value(w,_${e}.get);`))+"}",r):()=>{},h={i0:0,i1:0,index:0,size:0,peer:l,init(t,e,n,l){h.index=h.i0=h.i1=0,h.size=e.length,a=t,o=e,u=n,c=l,i=s?s.map((t=>t.init())):null;for(let t=0;t<f;++t)r[t].init();return h},value:(e,n)=>n(a[e],t),step(r){const[f,p]=e,g=h.size,y=h.i0,v=h.i1;h.i0=null!=f?Math.max(0,r-Math.abs(f)):0,h.i1=null!=p?Math.min(g,r+Math.abs(p)+1):g,h.index=r,n&&(h.i0>0&&l(h.i0)&&(h.i0=xr.left(o,o[h.i0])),h.i1<g&&l(h.i1)&&(h.i1=xr.right(o,o[h.i1-1])));for(let e=0;e<d;++e){const n=s[e],r=i[e];for(let e=y;e<h.i0;++e)n.rem(r,a[e],t);for(let e=v;e<h.i1;++e)n.add(r,a[e],t);n.write(r,u,c)}return m(h,u,c),u}};return h}(e,t.frame,t.peers,t.winOps,he(t.aggOps,null!=t.frame[0]?-1:1))))}(s,a),i=o.length,u=ee(["r","d","op"],"{"+te(e,((t,e)=>`_${e}[r] = $${e}(r, d, op);`))+"}",e,n);t.partitions().forEach(((e,n)=>{const s=e.length,c=function(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),s=e.length,a=new Uint32Array(s);for(let t=1,o=0;t<s;++t)a[t]=n(e[t-1],e[t],r)?++o:o;return a}return e}(t,e);for(let t=0;t<i;++t)o[t].init(e,c,r,n);const l=t=>r[t][n];for(let t=0;t<s;++t){for(let e=0;e<i;++e)o[e].step(t);u(e[t],a,l)}}))}function Ar(t){return Qt(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function jr(t,{names:e,exprs:n,ops:r=[]},s={}){const a=t.totalRows(),o=lr(s.drop?null:t),i=e.map((t=>o.add(t,Array(a)))),[u,c]=function(t){const e=[],n=[],r=t.length;for(let s=0;s<r;++s){const r=t[s];r.id=s,(Ar(r)?n:e).push(r)}return[e,n]}(r),l=t.isGrouped()?t.groups().size:1,f=me(t,u,fe(r.length,(()=>Array(l))));return c.length?Er(t,i,n,f,c):function(t,e,n,r){const s=t.mask(),a=t.data(),{keys:o}=t.groups()||{},i=o?(t,e)=>r[t][o[e]]:t=>r[t][0],u=e.length;for(let r=0;r<u;++r){const o=n[r],u=e[r];if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))u[t]=o(t,a,i);else{const e=t.totalRows();for(let t=0;t<e;++t)u[t]=o(t,a,i)}}}(t,i,n,f),o.derive(t)}function kr(t,e){const n=Gn({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const e=jr(t,n,{drop:!0}).column("p");r=t=>e.at(t)}return function(t,e){const n=t.totalRows(),r=t.mask(),s=t.data(),a=new R(n);if(r)for(let t=r.next(0);t>=0;t=r.next(t+1))e(t,s)&&a.set(t);else for(let t=0;t<n;++t)e(t,s)&&a.set(t);return t.create({filter:a})}(t,r)}function Nr(t,...e){return kr(ur(t,(e=e.flat()).length?e:t.columnNames()),"row_number() === 1").ungroup().reify()}function Sr(t,e){const n=new Map;return t.scan(((t,r)=>{const s=e(t,r);null!=s&&s==s&&n.set(s,t)})),n}function Or(t,e,n){const r=new Map;Et(n).forEach(((n,s)=>{V(n=cn(n)?e.columnName(n):n)?r.set(s,Yn(n)):le(n)||lt(n)&&n.expr?r.set(s,n):Rt(`Invalid ${t} key value: ${n+""}`)}));return Pt(Gn(r,{table:e,aggregate:!1,window:!1}).exprs,!0)}function Tr(t,e,n){if(n)V(n)?n=[n,n]:q(n)&&1===n.length&&(n=[n[0],n[0]]);else{const r=function(t,e){const n=new Set(e);return t.filter((t=>n.has(t)))}(t.columnNames(),e.columnNames());r.length||Rt("Natural join requires shared column names."),n=[r,r]}return n}function Cr(t,e,n,r){return n.length!==r.length&&Rt("Mismatched number of join keys"),[Or("join",t,n),Or("join",e,r)]}function Ir(t,e,n){return Dr(t,e,n,{anti:!1})}function Ur(t,e,n){return Dr(t,e,n,{anti:!0})}function Dr(t,e,n,r){n=Tr(t,e,n);return function(t,e,n,r={}){const s=new R(t.totalRows()),a=q(n)?Fr:Rr;a(s,t,e,n),r.anti&&s.not().and(t.mask());return t.create({filter:s})}(t,e,q(n)?Cr(t,e,...n.map(Et)):Gn({on:n},{join:[t,e]}).exprs[0],r)}function Fr(t,e,n,[r,s]){const a=Sr(n,s);e.scan(((e,n)=>{a.get(r(e,n))>=0&&t.set(e)}))}function Rr(t,e,n,r){const s=e.numRows(),a=n.numRows(),o=e.data(),i=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),c=n.indices(!1);for(let e=0;e<s;++e){const n=u[e];for(let e=0;e<a;++e)if(r(n,o,c[e],i)){t.set(n);break}}}else for(let e=0;e<s;++e)for(let n=0;n<a;++n)if(r(e,o,n,i)){t.set(e);break}}function zr(t,{names:e=[],exprs:n=[],ops:r=[]},s={}){if(!e.length)return t;const a=s.limit>0?+s.limit:1/0,o=s.index?!0===s.index?"index":s.index+"":null,i=new Set(s.drop),u=de(t,r,n),c=lr(),l=new Set(e),f=[],d=[],m=[];t.columnNames().forEach((e=>{if(!i.has(e)){const n=c.add(e,[]);l.has(e)||(f.push(t.column(e)),d.push(n))}})),e.forEach((t=>{i.has(t)||(c.has(t)||c.add(t,[]),m.push(c.data[t]))}));const h=o?c.add(o,[]):null;let p=0;const g=f.length,y=m.length,v=(t,e)=>{for(let n=0;n<g;++n)d[n].length=p+e,d[n].fill(f[n].at(t),p,p+e)},w=h?(t,e)=>{for(let n=0;n<e;++n)h[t+n]=n}:()=>{};if(1===y){const e=u[0],n=m[0];t.scan(((t,r)=>{const s=Et(e(t,r)),o=Math.min(s.length,a);v(t,o);for(let t=0;t<o;++t)n[p+t]=s[t];w(p,o),p+=o}))}else t.scan(((t,e)=>{let n=0;const r=u.map((r=>{const s=Et(r(t,e));return n=Math.min(Math.max(n,s.length),a),s}));v(t,n);for(let t=0;t<y;++t){const e=m[t],s=r[t];for(let t=0;t<n;++t)e[p+t]=s[t]}w(p,n),p+=n}));return c.new(t)}function qr(t,e,n){return function(t,{names:e=[],exprs:n=[],ops:r=[]},s={}){if(0===e.length)return t;const[a="key",o="value"]=s.as||[],i=de(t,r,n);return zr(t,{names:[a,o],exprs:[()=>e,(t,e)=>i.map((n=>n(t,e)))]},{...s,drop:e})}(t,ir("fold",t,e),n)}function Pr(t){return t.isGrouped()?t.create({groups:null}):t}function Br(t){t.forEach(((e,n)=>e.field?t.set(n,Ct(e+"")):0))}function Lr(t,e,n,r){const s=n&&n.length;t=s?function(t,e,n){const r=t.groups(),s=t.data(),a=(r?r.names:[]).concat(e),o=(r?r.get:[]).concat(e.map((e=>t.getter(e)))),i=new Set,u=Pt(o);t.scan(((t,e)=>i.add(u(t,e))));const c=t.columnNames(),l=lr(),f=c.map((t=>l.add(t,[])));c.forEach(((e,n)=>{const r=s[e],a=f[n];t.scan((t=>a.push(r.at(t))))}));const d=Pt(o.map(((t,e)=>t=>t[e]))),m=ee("v","{"+f.map(((t,e)=>`_${e}.push(v[$${e}]);`)).join("")+"}",f,c.map((t=>a.indexOf(t))));if(r){let t=r.keys.length;const e=n.reduce(((t,e)=>t*e.length),r.size),s=new Uint32Array(e+(t-i.size));s.set(r.keys),Vr(r,n,((e,n)=>{i.has(d(e))||(m(e),s[t++]=n[0])})),l.groupby({...r,keys:s})}else Vr(r,n,(t=>{i.has(d(t))||m(t)}));return l.new(t)}(t,n,r):t;const{names:a,exprs:o,ops:i}=e,u=de(t,i,o),c=s?null:lr(t),l=t.totalRows();return a.forEach(((e,n)=>{const r=t.column(e),a=s?r:c.add(e,Array(l)),o=u[n];t.scan((t=>{const e=r.at(t);a[t]=G(e)?e:o(t)}))})),s?t:t.create(c)}function Vr(t,e,n){const r=t?t.get.length:0,s=t?1:0,a=s+e.length,o=new Int32Array(a),i=new Int32Array(a),u=[];if(t){const{get:e,rows:n,size:s}=t;o[0]=s,u.push(((t,s)=>{const a=n[s];for(let n=0;n<r;++n)t[n]=e[n](a)}))}e.forEach(((t,e)=>{const n=e+r;o[e+s]=t.length,u.push(((e,r)=>e[n]=t[r]))}));const c=Array(r+e.length);for(let t=0;t<a;++t)u[t](c,0);n(c,i);for(let t=a-1;t>=0;){const e=++i[t];e<o[t]?(u[t](c,e),n(c,i),t=a-1):(i[t]=0,u[t](c,0),--t)}}const Gr={aggregate:!1,window:!1,index:1},Hr=-1/0;function Wr(t,e,n,r,s={}){n=Tr(t,e,n);const a={join:[t,e]};let o;if(q(n)){const[a,i]=n.map(Et);o=Cr(t,e,a,i),r||(r=function(t,e,n,r){const s=[];e.forEach(((t,e)=>V(t)&&t===n[e]?s.push(t):0));const a=nr(s);if(r.left&&r.right){const e=new Set(s);return[t.columnNames().map((t=>{const n=`[${jt(t)}]`;return e.has(t)?{[t]:`(a, b) => a${n} == null ? b${n} : a${n}`}:t})),a]}return r.right?[a,er()]:[er(),a]}(t,a,i,s))}else o=Gn({on:n},a).exprs[0],r||(r=[er(),er()]);return function(t,e,n,{names:r,exprs:s},a={}){const o=t.data(),i=t.indices(!1),u=i.length,c=new Int32Array(u),l=e.data(),f=e.indices(!1),d=f.length,m=new Int32Array(d),h=r.length,p=lr(),g=Array(h),y=Array(h);for(let t=0;t<r.length;++t)g[t]=p.add(r[t],[]),y[t]=s[t];const v=function(t,e){const n=["i","a","j","b"];return ee(n,"{"+te(t,((t,e)=>`_${e}.push($${e}(${n}));`))+"}",t,e)}(g,y),w=q(n)?Qr:Yr;if(w(v,n,o,l,i,f,c,m,u,d),a.left)for(let t=0;t<u;++t)c[t]||v(i[t],o,Hr,l);if(a.right)for(let t=0;t<d;++t)m[t]||v(Hr,o,f[t],l);return p.new(t)}(t,e,o,function(t,e,n,r,s=[]){if(q(n)){let a,o,i,u=n.length;a=o=i={names:[],exprs:[]},u--&&(a=ir("join",t,n[0],r)),u--&&(o=ir("join",e,n[1],Gr)),u--&&(i=Gn(n[2],r));const c=new Set,l=new Set(a.names);return o.names.forEach((t=>{l.has(t)&&c.add(t)})),c.size&&(""!==s[0]&&Jr(a.names,c,s[0]||"_1"),""!==s[1]&&Jr(o.names,c,s[1]||"_2")),{names:a.names.concat(o.names,i.names),exprs:a.exprs.concat(o.exprs,i.exprs)}}return Gn(n,r)}(t,e,r,a,s&&s.suffix),s)}function Jr(t,e,n){t.forEach(((r,s)=>e.has(r)?t[s]=r+n:0))}function Yr(t,e,n,r,s,a,o,i,u,c){for(let l=0;l<u;++l){const u=s[l];for(let s=0;s<c;++s){const c=a[s];e(u,n,c,r)&&(t(u,n,c,r),o[l]=1,i[s]=1)}}}function Qr(t,[e,n],r,s,a,o,i,u,c,l){let f,d,m,h,p,g,y,v,w=t;c>=l?(f=r,d=e,m=i,h=a,p=s,g=n,y=u,v=o):(f=s,d=n,m=u,h=o,p=r,g=e,y=i,v=a,w=(e,n,r,s)=>t(r,s,e,n));const _=function(t,e,n){const r=new Map,s=t.length;for(let a=0;a<s;++a){const s=n(t[a],e);null!=s&&s==s&&(r.has(s)?r.get(s).push(a):r.set(s,[a]))}return r}(v,p,g),b=h.length;for(let t=0;t<b;++t){const e=h[t],n=_.get(d(e,f));if(n){const r=n.length;for(let t=0;t<r;++t){const r=n[t];w(e,f,v[r],p),y[r]=1}m[t]=1}}}function Zr(t,e,n,...r){return function(t,e,[n,r],{names:s,exprs:a,ops:o=[]}){const i=lr(t),u=t.totalRows();s.forEach((t=>i.add(t,Array(u).fill(z))));const c=Sr(e,r),l=ee(["lr","rr","data"],"{"+te(s,((t,e)=>`_[${e}][lr] = $[${e}](rr, data);`))+"}",s.map((t=>i.data[t])),de(e,o,a)),f=e.data();return t.scan(((t,e)=>{const r=c.get(n(t,e));r>=0&&l(t,r,f)})),i.derive(t)}(t,e,[Or("lookup",t,(n=Tr(t,e,n))[0]),Or("lookup",e,n[1])],ir("lookup",e,r.flat()))}const Kr=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n    : (u > v || v == null) && u != null ? ${r}\n    : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n    : v !== v && u === u ? ${r} : `;function Xr(t,...e){return function(t,e){return t.create({order:e})}(t,function(t,e){let n=-1;const r=new Map,s=t=>r.set(++n+"",t);return e.forEach((e=>{const n=null!=e.expr?e.expr:e;if(lt(n)&&!le(n))for(const t in n)s(n[t]);else s(cn(n)?Yn(e,t.columnName(n)):V(n)?Yn(e):le(n)?e:Rt("Invalid orderby field: "+(e+"")))})),function(t,e){const n=[],r=[],s=[];let a=null,o="0",i="0";t.isGrouped()&&(a=t.groups().keys,o="ka",i="kb");const{ops:u}=Gn(e,{table:t,value:(t,e)=>{if(n.push(t),e.escape){const t=t=>`fn[${s.length}](${t}, data)`;r.push([t("a"),t("b")]),s.push(e.escape)}else r.push([Ye(e,{index:"a",op:o}),Ye(e,{index:"b",op:i})])},window:!1}),c=me(t,u),l=(t,e)=>c[t][e],f=n.length;let d="return (a, b) => {"+(l&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let t=0;t<f;++t){const s=e.get(n[t]).desc?-1:1,[a,o]=r[t];d+=Kr(a,o,-s,s)}return d+="0;};",Function("op","keys","fn","data",d)(l,a,s,t.data())}(t,r)}(t,e.flat()))}function ts(t,e,n,r){return function(t,e,n,r={}){const{keys:s,keyColumn:a}=function(t,e,n){const r=n.limit>0?+n.limit:1/0,s=ns(n.sort,!0),a=ns(n.keySeparator,"_"),o=de(t,e.ops,e.exprs),i=1===o.length?o[0]:(t,e)=>o.map((n=>n(t,e))).join(a),u=Array(t.totalRows());t.scan(((t,e)=>u[t]=i(t,e)));const c=me(Pr(t),[{id:0,name:"array_agg_distinct",fields:[t=>u[t]],params:[]}])[0][0],l=s?c.sort():c;return{keys:Number.isFinite(r)?l.slice(0,r):l,keyColumn:u}}(t,e,r),o=ns(r.valueSeparator,"_"),i=n.names.length>1?(t,e)=>e+o+s[t]:t=>s[t],u=s.map((e=>me(t,n.ops.map((t=>{if("count"===t.name){const n=t=>e===a[t]?1:NaN;return n.toString=()=>e+":1",{...t,name:"sum",fields:[n]}}const n=t.fields.map((t=>{const n=(n,r)=>e===a[n]?t(n,r):NaN;return n.toString=()=>e+":"+t,n}));return{...t,fields:n}})))));return function({names:t,exprs:e},n,r,s){const a=r?r.size:1,o=lr(),i=s.length,u=t.length;let c;const l=(t,e)=>c[t][e];r&&ye(o,r);for(let r=0;r<u;++r){const u=e[r];if(null!=u.field)for(let e=0;e<i;++e)o.add(n(e,t[r]),s[e][u.field]);else if(a>1)for(let e=0;e<i;++e){c=s[e];const i=o.add(n(e,t[r]),Array(a));for(let t=0;t<a;++t)i[t]=u(t,null,l)}else for(let e=0;e<i;++e)c=s[e],o.add(n(e,t[r]),[u(0,null,l)])}return o}(n,i,t.groups(),u).new(t)}(t,ir("fold",t,e),ir("fold",t,n,{preparse:es,window:!1,aggronly:!0}),r)}function es(t){t.forEach(((e,n)=>e.field?t.set(n,St(e+"")):0))}const ns=(t,e)=>null!=t?t:e;function rs(t,e,n,r){return(e?r?as:ss:r?is:os)(t.length,t,n,r)}function ss(t,e,n){const r=n.length;for(let s=0;s<t;++s)e[s]=n[r*pt()|0];return e}function as(t,e,n,r){const s=n.length,a=new Float64Array(s);let o=0;for(let t=0;t<s;++t)a[t]=o+=r(n[t]);const i=br(ne).right;for(let r=0;r<t;++r)e[r]=n[i(a,o*pt())];return e}function os(t,e,n){const r=n.length;if(t>=r)return n;for(let r=0;r<t;++r)e[r]=n[r];for(let s=t;s<r;++s){const r=s*pt();r<t&&(e[0|r]=n[s])}return e}function is(t,e,n,r){const s=n.length;if(t>=s)return n;const a=new Float32Array(s),o=new Uint32Array(s);for(let t=0;t<s;++t)o[t]=t,a[t]=-Math.log(pt())/r(n[t]);o.sort(((t,e)=>a[t]-a[e]));for(let r=0;r<t;++r)e[r]=n[o[r]];return e}function us(t,e,n={}){return function(t,e,n,r={}){const{replace:s,shuffle:a}=r,o=t.partitions(!1);let i=0;e=o.map(((t,n)=>{let r=e(n);return i+=r=s?r:Math.min(t.length,r),r}));const u=new Uint32Array(i);let c=0;o.forEach(((t,r)=>{const a=e[r],o=u.subarray(c,c+=a);s||a!==t.length?rs(o,s,t,n):o.set(t)})),!1!==a&&(o.length>1||!s)&&function(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const n=pt()*r--|0,s=t[r+e];t[r+e]=t[n+e],t[n+e]=s}}(u);return t.reify(u)}(t,function(t,e){return cn(e)?()=>e:cs(mr(t,Gn({size:e},{table:t,window:!1})).column("size"))}(t,e),function(t,e){return null==e?null:(e=cn(e)?t.columnName(e):e,cs(V(e)?t.column(e):jr(t,Gn({w:e},{table:t}),{drop:!0}).column("w")))}(t,n.weight),n)}const cs=t=>e=>t.at(e)||0;function ls(t){return t<0?`count() + ${t}`:t}function fs(t,e=0,n=1/0){if(t.isGrouped())return kr(t,function(t=0,e=1/0){return`${ls(t)} < row_number() && row_number() <= ${ls(e)}`}(e,n)).reify();const r=[],s=t.numRows();return e=Math.max(0,e+(e<0?s:0)),n=Math.min(s,Math.max(0,n+(n<0?s:0))),t.scan((t=>r.push(t)),!0,n-e,e),t.reify(r)}function ds(t,e,n){return function(t,{names:e,exprs:n,ops:r=[]},s={}){if(0===e.length)return t;const a=1===e.length&&s.as||[],o=null==s.drop||!!s.drop,i=null==s.limit?a.length||1/0:Math.max(1,+s.limit||1),u=de(t,r,n),c=lr(),l=e.reduce(((t,e,n)=>t.set(e,n)),new Map),f=(e,n)=>{const r=function(t,e,n){const r=t.totalRows(),s=[];return t.scan(((t,a)=>{const o=Et(e(t,a)),i=Math.min(o.length,n);for(;s.length<i;)s.push(Array(r).fill(z));for(let e=0;e<i;++e)s[e][t]=o[e]})),s}(t,u[e],i),s=r.length;for(let t=0;t<s;++t)c.add(a[t]||`${n}_${t+1}`,r[t])};return t.columnNames().forEach((e=>{l.has(e)?(o||c.add(e,t.column(e)),f(l.get(e),e),l.delete(e)):c.add(e,t.column(e))})),l.forEach(f),c.derive(t)}(t,ir("spread",t,e),n)}const ms=t=>Rt("Apache Arrow not imported, see https://github.com/uwdata/arquero#usage",t);function hs(t,e=1){return(t*e+63&-64||64)/e}function ps(t,e,n=t.BYTES_PER_ELEMENT){return new t(hs(e,n))}function gs(t){return t instanceof s?t:new s(t.type,0,t.length,t.nulls,t.buffers,null,t.dict)}const ys=new TextEncoder;const vs=ys.encodeInto?function(t,e,n){return ys.encodeInto(n,t.subarray(e)).written}:function(t,e,n){const r=ys.encode(n);return t.set(r,e),r.length};function ws(t,e){const n=ps(t.ArrayType,e);return{set(t,e){n[e]=t},data:()=>({type:t,length:e,buffers:[null,n]})}}function _s(t,e){const n=ps(t.ArrayType,e/8);return{set(t,e){t&&(n[e>>3]|=1<<e%8)},data:()=>({type:t,length:e,buffers:[null,n]})}}function bs(t,e){const n=ps(t.ArrayType,e);return{set(t,e){n[e]=t/864e5|0},data:()=>({type:t,length:e,buffers:[null,n]})}}function xs(t,e){const n=ps(t.ArrayType,e);return{set(t,e){n[e]=BigInt(t)},data:()=>({type:t,length:e,buffers:[null,n]})}}function Ms(t,e){const n=[],r=ps(t.indices.ArrayType,e),s=Object.create(null);let a=-1,o=0;return{set(t,e){const i=String(t);let u=s[i];void 0===u&&(o+=i.length,s[i]=u=++a,n.push(i)),r[e]=u},data:()=>({type:t,length:e,buffers:[null,r],dict:$s(t.dictionary,n,o)})}}function $s(t,e,n){const r=function(t,e,n){const r=ps(Int32Array,e+1),s=ps(Uint8Array,3*n);let a=0;return{set(t,e){a+=vs(s,a,t),r[e+1]=a},data:()=>{const n=hs(a),o=s.length>n?s.subarray(0,n):s;return{type:t,length:e,buffers:[r,o]}}}}(t,e.length,n);return e.forEach(r.set),s=r.data(),new a([gs(s)]);var s}function Es(t,e,n=!0){let r;switch(t.typeId){case i.Int:r=t.bitWidth<64?ws:null;break;case i.Float:r=t.precision>0?ws:null;break;case i.Dictionary:r=t.dictionary.typeId===i.Utf8&&t.indices.typeId===i.Int&&t.indices.bitWidth<64?Ms:null;break;case i.Bool:r=_s;break;case i.Date:r=t.unit?xs:bs}return null==r?function(t){const e=o({type:t,nullValues:[null,void 0]});return{set(t,n){e.set(n,t)},data:()=>e.finish().flush()}}(t):n?function(t,e){const n=ps(Uint8Array,e/8);let r=0;return{set(e,s){null==e?++r:(t.set(e,s),n[s>>3]|=1<<s%8)},data:()=>{const e=t.data();return r&&(e.nulls=r,e.buffers[2]=n),e}}}(r(t,e),e):r(t,e)}function As(t,e,n,r,s=!0){const a=Es(r,t,s);return e(n,a.set),gs(a.data())}function js(t){if(t instanceof u||null==t)return t;switch(t){case i.Binary:return new T;case i.Bool:return new O;case i.DateDay:return new S;case i.DateMillisecond:case i.Date:return new N;case i.Dictionary:return new k(new c,new x);case i.Float16:return new j;case i.Float32:return new A;case i.Float64:case i.Float:return new E;case i.Int8:return new $;case i.Int16:return new M;case i.Int32:case i.Int:return new x;case i.Int64:return new b;case i.IntervalDayTime:return new _;case i.Interval:case i.IntervalYearMonth:return new w;case i.Null:return new v;case i.TimeMicrosecond:return new y;case i.TimeMillisecond:case i.Time:return new g;case i.TimeNanosecond:return new p;case i.TimeSecond:return new h;case i.Uint8:return new m;case i.Uint16:return new d;case i.Uint32:return new f;case i.Uint64:return new l;case i.Utf8:return new c;default:Rt(`Unsupported type code: ${jt(t)}. Use a data type constructor instead?`)}}function ks(t,e){const n=Ns();return t(e,n.add),n}function Ns(){const t={count:0,nulls:0,bools:0,nums:0,ints:0,bigints:0,min:1/0,max:-1/0,digits:0,dates:0,utcdays:0,strings:0,strlen:0,arrays:0,minlen:1/0,maxlen:0,structs:0,add(e){if(++t.count,null==e)return void++t.nulls;const n=typeof e;if("string"===n)++t.strings;else if("number"===n)++t.nums,e<t.min&&(t.min=e),e>t.max&&(t.max=e),Number.isInteger(e)&&++t.ints;else if("boolean"===n)++t.bools;else if("object"===n)if(ut(e))++t.dates,0===(r=e).getUTCHours()&&0===r.getUTCMinutes()&&0===r.getUTCSeconds()&&0===r.getUTCMilliseconds()&&++t.utcdays;else if(L(e)){++t.arrays,e.length<t.minlen&&(t.minlen=e.length),e.length>t.maxlen&&(t.maxlen=e.length);const n=t.array_prof||(t.array_prof=Ns());e.forEach(n.add)}else{++t.structs;const n=t.struct_prof||(t.struct_prof={});for(const t in e){(n[t]||(n[t]=Ns())).add(e[t])}}else"bigint"===n&&(++t.bigints,e<t.min&&(t.min=e),e>t.max&&(t.max=e));var r},type:()=>js(function(t){const e=t.count-t.nulls;if(0===e)return i.Null;if(t.ints===e){const e=Math.max(Math.abs(t.min)-1,t.max);return t.min<0?e>=2**31?i.Float64:e<128?i.Int8:e<32768?i.Int16:i.Int32:e>=2**32?i.Float64:e<256?i.Uint8:e<65536?i.Uint16:i.Uint32}if(t.nums===e)return i.Float64;if(t.bigints===e){const e=-t.min>t.max?-t.min-1n:t.max;return t.min<0?e<2**63?i.Int64:Rt(`BigInt exceeds 64 bits: ${e}`):t.max<2**64?i.Uint64:Rt(`BigInt exceeds 64 bits: ${t.max}`)}if(t.bools===e)return i.Bool;if(t.utcdays===e)return i.DateDay;if(t.dates===e)return i.DateMillisecond;if(t.arrays===e){const e=C.new("value",t.array_prof.type(),!0);return t.minlen===t.maxlen?new I(t.minlen,e):new U(e)}if(t.structs===e){const e=t.struct_prof;return new D(Object.keys(e).map((t=>C.new(t,e[t].type(),!0))))}if(t.strings>0)return i.Dictionary;Rt("Type inference failure")}(t))};return t}function Ss(t,e,n,r,s,a=!0){if(!(s=js(s))){const t=ks(r,e);a=t.nulls>0,s=t.type()}return As(n,r,e,s,a)}function Os(t,e,n,r,s,o=!0){s=js(s);const i=t.column(e),u=!(t.isFiltered()||t.isOrdered()),c=(h=i)instanceof a?h:h.vector instanceof a?h.vector:null;var h;if(c&&u&&Ts(c.type,s))return c;const p=i.data;if(B(p)){const t=function(t){const e={Float32Array:A,Float64Array:E,Int8Array:$,Int16Array:M,Int32Array:x,Uint8Array:m,Uint16Array:d,Uint32Array:f,BigInt64Array:b,BigUint64Array:l}[t.constructor.name];return e?new e:null}(p);if(u&&t&&Ts(t,s))return function(t,e){const n=t.length,r=hs(n,t.BYTES_PER_ELEMENT);let s=t;return n!==r&&(s=new t.constructor(r),s.set(t)),gs({type:e,length:n,buffers:[null,s]})}(p,t);s=s||t,o=!1}if(!s){const t=ks(r,i);o=t.nulls>0,s=t.type()}return As(n,r,i,s,o)}function Ts(t,e){return!t||!e||t.compareTo(e)}function Cs(t,e,n){const r=Math.min(t.length,n+e);return(e,s)=>{for(let a=n;a<r;++a)s(t[a][e],a)}}function Is(t,e,n){const r=0===n&&t.numRows()<=e&&!t.isFiltered()&&!t.isOrdered();return(s,a)=>{const o=L(s);let i=-1;r&&o?s.forEach(a):t.scan(o?t=>a(s[t],++i):t=>a(s.at(t),++i),!0,e,n)}}function Us(t,n={}){const{types:r={}}=n,{dataFrom:s,names:a,nrows:o,scan:i}=function(t,e){const{columns:n,limit:r=1/0,offset:s=0}=e,a=le(n)?n(t):q(n)?n:null;if(q(t))return{dataFrom:Ss,names:a||Object.keys(t[0]),nrows:Math.min(r,t.length-s),scan:Cs(t,r,s)};if(function(t){return t&&le(t.reify)}(t))return{dataFrom:Os,names:a||t.columnNames(),nrows:Math.min(r,t.numRows()-s),scan:Is(t,r,s)};Rt("Unsupported input data type")}(t,n),u={};return a.forEach((e=>{const n=s(t,e,o,i,r[e]);n.length!==o&&Rt("Column length mismatch"),u[e]=n})),function(...t){try{return new e(...t)}catch(t){ms(t)}}(u)}function Ds(t,e={}){const{format:n="stream",...s}=e;if(!["stream","file"].includes(n))throw Error("Unrecognised Arrow IPC output format");return function(t,e){try{return r(t,e)}catch(t){ms(t)}}(Us(t,s),n)}function Fs(t,e){return le(e)?e(t):e||t.columnNames()}function Rs(t,e,n){const r=n.format||{},s=n.align||{},a={},o={};return e.forEach((e=>{const i=function(t,e={}){let n=0,r=0,s=0,a=0,o=0,i=0;return t((t=>{if(++n,null==t)return void++r;const e=typeof t;if("object"===e&&ut(t))++s,0===(u=t).getUTCHours()&&0===u.getUTCMinutes()&&0===u.getUTCSeconds()&&0===u.getUTCMilliseconds()&&++a;else if("number"===e&&(++o,t==t&&(0|t)!==t)){const e=t+"",n=e.indexOf(".");if(n>=0){const t=e.indexOf("e"),r=t>0?t:e.length;i=Math.max(i,r-n-1)}}var u})),{align:(r+o+s)/n>.5?"r":"l",format:{utc:s===a,digits:Math.min(i,e.maxdigits||6)}}}(function(t,e){const n=t.column(e);return e=>t.scan((t=>e(n.at(t))))}(t,e),n);o[e]=s[e]||i.align,a[e]=r[e]||i.format})),{align:o,format:a}}function zs(t,e,n=100,r,s){const a=t.data(),o=e.length;t.scan((t=>{s.row(t);for(let n=0;n<o;++n){const r=e[n];s.cell(a[e[n]].at(t),r,n)}}),!0,n,r)}function qs(t,e={}){const n=Fs(t,e.columns),r=e.format||{},s=e.delimiter||",",a=new RegExp(`["${s}\n\r]`),o=t=>null==t?"":ut(t)?X(t,!0):a.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t,i=n.map(o);let u="";return zs(t,n,e.limit||1/0,e.offset,{row(){u+=i.join(s)+"\n"},cell(t,e,n){i[n]=o(r[e]?r[e](t):t)}}),u+i.join(s)}function Ps(t,e={}){if(le(e))return e(t)+"";const n=typeof t;if("object"===n){if(ut(t))return e.utc?X(t):K(t);{const n=JSON.stringify(t,((t,e)=>B(e)?Array.from(e):e)),r=e.maxlen||30;return n.length>r?n.slice(0,28)+""+("["===n[0]?"]":"}"):n}}if("number"===n){const n=e.digits||0;let r;return 0!==t&&((r=Math.abs(t))>=1e18||r<Math.pow(10,-n))?t.toExponential(n):t.toFixed(n)}return t+""}function Bs(t,e={}){const n=Fs(t,e.columns),{align:r,format:s}=Rs(t,n,e),a=function(t){return function(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}(t.style,(t=>le(t)?t:()=>t))}(e),o=e.null,i=(t,e)=>Ps(t,e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=o?(t,e)=>null==t?o(t):i(t,e):i;let c=-1,l=-1;const f=(t,e,n)=>{const s=n?(t=>"c"===t?"center":"r"===t?"right":"left")(r[e]):"",o=a[t]&&a[t](e,l,c)||"",i=(s?`text-align: ${s};`+(o?" ":""):"")+o;return`<${t}${i?` style="${i}"`:""}>`};let d=f("table")+f("thead")+f("tr",c)+n.map((t=>`${f("th",t,1)}${t}</th>`)).join("")+"</tr></thead>"+f("tbody");return zs(t,n,e.limit,e.offset,{row(t){c=t,d+=(++l?"</tr>":"")+f("tr")},cell(t,e){d+=f("td",e,1)+u(t,s[e])+"</td>"}}),d+"</tr></tbody></table>"}function Ls(t,e=!0,n=!1){return void 0===t||t?e:n}const Vs=t=>ut(t)?X(t,!0):t;function Gs(t,e={}){const n=Ls(e.schema),r=e.format||{},s=Fs(t,e.columns);let a="{";return n&&(a+='"schema":{"fields":'+JSON.stringify(s.map((t=>({name:t}))))+'},"data":{'),s.forEach(((n,s)=>{a+=(s?",":"")+JSON.stringify(n)+":[";const o=t.column(n),i=r[n]||Vs;let u=-1;t.scan((t=>{const e=o.at(t);a+=(++u?",":"")+JSON.stringify(i(e))}),!0,e.limit,e.offset),a+="]"})),a+"}"+(n?"}":"")}function Hs(t,e={}){const n=Fs(t,e.columns),{align:r,format:s}=Rs(t,n,e),a=t=>t.replace(/\|/g,"\\|");let o="|"+n.map(a).join("|")+"|\n|"+n.map((t=>{return"c"===(e=r[t])?":-:":"r"===e?"-:":":-";var e})).join("|")+"|";return zs(t,n,e.limit,e.offset,{row(){o+="\n|"},cell(t,e){o+=a(Ps(t,s[e]))+"|"}}),o+"\n"}class Ws extends yr{assign(...t){return function(t,...e){e=e.flat();const n=t.numRows(),r=t.reify(),s=lr(r).groupby(r.groups());return e.forEach((t=>{(t=t instanceof yr?t:new yr(t)).numRows()!==n&&Rt("Assign row counts do not match"),(t=t.reify()).columnNames((e=>s.add(e,t.column(e))))})),s.new(t)}(this,...t)}count(t={}){const{as:e="count"}=t;return dr(this,{[e]:Ot()})}derive(t,e){return function(t,e,n={}){const r=jr(t,Gn(e,{table:t}),n);return n.drop||null==n.before&&null==n.after?r:_r(r,Object.keys(e).filter((e=>!t.column(e))),n)}(this,t,e)}filter(t){return kr(this,t)}slice(t,e){return fs(this,t,e)}groupby(...t){return ur(this,...t)}orderby(...t){return Xr(this,...t)}relocate(t,e){return _r(this,Et(t),e)}rename(...t){return function(t,...e){const n=new Map;return t.columnNames((t=>(n.set(t,t),0))),pr(t,Kn(t,e.flat(),n))}(this,...t)}reduce(t){return function(t,e){const n=lr(),r=t.groups(),{get:s,names:a=[],rows:o,size:i=1}=r||{},u=new Uint32Array(i+1);a.forEach((t=>n.add(t,null)));const c=r?ge(t,e,r):[pe(t,e)];e.outputs().map((t=>n.add(t,[])));const l=u.length-1;let f=0;for(let t=0;t<l;++t)f+=u[t+1]=e.write(c[t],n.data,u[t]);if(r){const e=t.data();a.forEach(((t,r)=>{const a=n.data[t]=Array(f),c=s[r];for(let t=0,n=0;t<i;++t)a.fill(c(o[t],e),n,n+=u[t+1])}))}return n.new(t)}(this,t)}rollup(t){return dr(this,t)}sample(t,e){return us(this,t,e)}select(...t){return hr(this,...t)}ungroup(){return Pr(this)}unorder(){return function(t){return t.isOrdered()?t.create({order:null}):t}(this)}dedupe(...t){return Nr(this,...t)}impute(t,e){return function(t,e,n={}){if((e=Gn(e,{table:t})).names.forEach((e=>t.column(e)?0:Rt(`Invalid impute column ${jt(e)}`))),n.expand){const r={preparse:Br,window:!1,aggronly:!0},s=ir("impute",t,n.expand,r),a=mr(Pr(t),s);return Lr(t,e,s.names,s.names.map((t=>a.get(t,0))))}return Lr(t,e)}(this,t,e)}fold(t,e){return qr(this,t,e)}pivot(t,e,n){return ts(this,t,e,n)}spread(t,e){return ds(this,t,e)}unroll(t,e){return function(t,e,n){return zr(t,ir("unroll",t,e),n&&n.drop?{...n,drop:ir("unroll",t,n.drop).names}:n)}(this,t,e)}lookup(t,e,...n){return Zr(this,t,e,...n)}join(t,e,n,r){return Wr(this,t,e,n,r)}join_left(t,e,n,r){return Wr(this,t,e,n,{...r,left:!0,right:!1})}join_right(t,e,n,r){return Wr(this,t,e,n,{...r,left:!1,right:!0})}join_full(t,e,n,r){return Wr(this,t,e,n,{...r,left:!0,right:!0})}cross(t,e,n){return function(t,e,n,r){return Wr(t,e,(()=>!0),n,{...r,left:!0,right:!0})}(this,t,e,n)}semijoin(t,e){return Ir(this,t,e)}antijoin(t,e){return Ur(this,t,e)}concat(...t){return wr(this,...t)}union(...t){return function(t,...e){return Nr(wr(t,e.flat()))}(this,...t)}intersect(...t){return function(t,...e){e=e.flat();const n=t.columnNames();return e.length?Nr(e.reduce(((t,e)=>Ir(t,e.select(n))),t)):t.reify([])}(this,...t)}except(...t){return function(t,...e){if(0===(e=e.flat()).length)return t;const n=t.columnNames();return Nr(e.reduce(((t,e)=>Ur(t,e.select(n))),t))}(this,...t)}toArrow(t){return Us(this,t)}toArrowIPC(t){return Ds(this,t)}toCSV(t){return qs(this,t)}toHTML(t){return Bs(this,t)}toJSON(t){return Gs(this,t)}toMarkdown(t){return Hs(this,t)}}const Js=({typeId:t})=>-1===t,Ys=({typeId:t})=>2===t,Qs=({typeId:t})=>5===t,Zs=({typeId:t})=>7===t,Ks=({typeId:t})=>8===t,Xs=({typeId:t})=>10===t,ta=({typeId:t})=>13===t,ea=({typeId:t})=>20===t,na=({typeId:t})=>12===t||16===t;function ra(t,e){return Js(t.type)?function(t){const{data:e,length:n,nullCount:r}=t,s=e[e.length-1].dictionary,a=s.length,o=function(t,e,n,r){const s=t.length>1||n?function(t,e,n){const r=new n.ArrayType(e),s=t.length;for(let e,n=0,a=0;n<s;++n)e=t[n].length,r.set(t[n].values.subarray(0,e),a),a+=e;return r}(t,e,t[0].type.indices):t[0].values;return n?function(t,e,n){const r=t.length;for(let s,a,o,i,u=0,c=0;u<r;++u){if(o=t[u].nullBitmap,s=t[u].length>>3,o&&o.length)for(let t=0;t<=s;++t)255!==(i=o[t])&&(a=c+(t<<3),0==(1&i)&&(e[a+0]=n),0==(2&i)&&(e[a+1]=n),0==(4&i)&&(e[a+2]=n),0==(8&i)&&(e[a+3]=n),0==(16&i)&&(e[a+4]=n),0==(32&i)&&(e[a+5]=n),0==(64&i)&&(e[a+6]=n),0==(128&i)&&(e[a+7]=n));c+=t[u].length}return e}(t,s,r):s}(e||[t],n,r,a),i=sa(a,(t=>null==t||t<0||t>=a?null:s.get(t)));return{vector:t,length:n,at:t=>i(o[t]),key:t=>o[t],keyFor(t){if(null===t)return r?a:-1;for(let e=0;e<a;++e)if(i(e)===t)return e;return-1},groups(t){const e=a+(r?1:0);return{keys:o,get:[i],names:t,rows:Mt(0,e),size:e}},[Symbol.iterator]:()=>t[Symbol.iterator]()}}(t):function(t,e={}){const{type:n,length:r,numChildren:s}=t,{convertDate:a=!0,convertDecimal:o=!0,convertTimestamp:i=!0,convertBigInt:u=!1,memoize:c=!0}=e;let l;if(s)l=ia(t,e),c&&(l=sa(r,l));else if(c&&(Qs(n)||ea(n)))l=sa(r,(e=>t.get(e)));else if(a&&Ks(n)||i&&Xs(n))l=sa(r,(e=>null==t.get(e)?null:new Date(t.get(e))));else if(o&&Zs(n)){const e=1/Math.pow(10,n.scale);l=n=>{const r=t.get(n);return null==r?null:function(t,e){const n=t.length;let r=0;if(t.signed&&(0|t[n-1])<0){for(let e=0;e<n;++e)r+=~t[e]*aa[e];r=-(r+1)}else for(let e=0;e<n;++e)r+=t[e]*aa[e];return r*e}(r,e)}}else if(u&&Ys(n)&&n.bitWidth>=64)l=e=>{const n=t.get(e);return null==n?null:Number(n)};else{if(le(t.at))return t;l=e=>t.get(e)}return{length:r,at:l,[Symbol.iterator]:()=>function*(){for(let t=0;t<r;++t)yield l(t)}()}}(t,e)}function sa(t,e){const n=Array(t);return t=>{const r=n[t];return void 0!==r?r:n[t]=e(t)}}const aa=Array.from({length:8},((t,e)=>Math.pow(2,32*e)));function oa(t,e){return t.numChildren?fe(t.length,ia(t,e)):t.nullCount?[...t]:t.toArray()}function ia(t,e){return na(t.type)?function(t,e){return t.nullCount?n=>t.isValid(n)?oa(t.get(n),e):null:n=>oa(t.get(n),e)}(t,e):ta(t.type)?function(t,e){const n={...e,memoize:!1},r=[],s=[];t.type.children.forEach(((e,a)=>{r.push(ra(t.getChildAt(a),n)),s.push(`${jt(e.name)}:_${a}.at(row)`)}));const a=ee("row","({"+s+"})",r);return t.nullCount?e=>t.isValid(e)?a(e):null:a}(t,e):Rt(`Unsupported Arrow type: ${jt(t.VectorName)}`)}function ua(t,e){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t=function(t){try{return n(t)}catch(t){ms(t)}}(t));const{columns:r=er(),...s}=e||{},a=t.schema.fields.map((t=>t.name)),o=Kn({columnNames:t=>t?a.filter(t):a.slice(),columnIndex:t=>a.indexOf(t)},r),i=lr();return o.forEach(((e,n)=>{i.add(e,ra(t.getChild(n),s))})),new Ws(i.data,i.names)}var ca=t=>t;const la=[t=>"true"===t||"false"===t,t=>"false"!==t],fa=[t=>"NaN"===t||(t=+t)===t,t=>+t],da=[et,t=>new Date(Date.parse(t))];function ma(t){const{decimal:e}=t;return e&&"."!==e?fa.map((t=>n=>t(n&&n.replace(e,".")))):fa}function ha(t,e){const n=t.length;for(let r=0;r<n;++r){const n=t[r];if(null!=n&&!e(n))return!1}return!0}function pa(t,e=0){return fe(t-e,(t=>`col${t+e+1}`))}function ga(t,e,n){let r=t();const s=r.length,a=+n.autoMax||1e3,o=fe(s,(()=>[]));e=e?e.length<s?[...e,pa(s,e.length)]:e:pa(s);let i=0;for(;i<a&&r;++i,r=t())for(let t=0;t<s;++t)o[t].push(""===r[t]?null:r[t]);const u=function(t,e,n){const{parse:r={}}=n,s=!1===n.autoType;return t.map(((t,a)=>le(r[t])?r[t]:s?ca:function(t,e){const n=[la,ma(e),da],r=n.length;for(let e=0;e<r;++e){const[r,s]=n[e];if(ha(t,r))return s}return ca}(e[a],n)))}(e,o,n);for(u.forEach(((t,e)=>{if(t===ca)return;const n=o[e];for(let e=0;e<i;++e)null!=n[e]&&(n[e]=t(n[e]))}));r;r=t())for(let t=0;t<s;++t)o[t].push(r[t]?u[t](r[t]):null);const c={};return e.forEach(((t,e)=>c[t]=o[e])),new Ws(c,e)}const ya={},va={},wa=34,_a=10,ba=13;function xa(t,e,n){let r=+e||0;for(;--r>=0;)t();return n?()=>{let e;for(;!e;){if(!n(e=t()))return e;e=null}}:t}function Ma(t,e={}){const n=function(t,{delimiter:e=",",skip:n=0,comment:r}){1!==e.length&&Rt(`Text "delimiter" should be a single character, found "${e}"`);const s=e.charCodeAt(0);let a,o=t.length,i=0,u=o<=0,c=!1;function l(){if(u)return va;if(c)return c=!1,ya;const e=i;let n,r;if(t.charCodeAt(e)===wa){for(;i++<o&&t.charCodeAt(i)!==wa||t.charCodeAt(++i)===wa;);return(n=i)>=o?u=!0:(r=t.charCodeAt(i++))===_a?c=!0:r===ba&&(c=!0,t.charCodeAt(i)===_a&&++i),t.slice(e+1,n-1).replace(/""/g,'"')}for(;i<o;){if((r=t.charCodeAt(n=i++))===_a)c=!0;else if(r===ba)c=!0,t.charCodeAt(i)===_a&&++i;else if(r!==s)continue;return t.slice(e,n)}return u=!0,t.slice(e,o)}return t.charCodeAt(o-1)===_a&&--o,t.charCodeAt(o-1)===ba&&--o,xa((function(){if((a=l())!==va){const t=[];for(;a!==ya&&a!==va;)t.push(a),a=l();return t}}),n,r&&(t=>(t&&t[0]||"").startsWith(r)))}(t,e);return ga(n,!1!==e.header?n():e.names,e)}function $a(t,e={}){const n=function(t,{skip:e=0,comment:n}){let r=t.length,s=0;return t.charCodeAt(r-1)===_a&&--r,t.charCodeAt(r-1)===ba&&--r,xa((function(){if(s>=r)return;const e=s;let n,a,o=!1;for(;s<r;)if((a=t.charCodeAt(n=s++))===_a?o=!0:a===ba&&(o=!0,t.charCodeAt(s)===_a&&++s),o)return t.slice(e,n);return t.slice(e,r)}),e,n&&(t=>(t||"").startsWith(n)))}(t,e),r=function({positions:t,widths:e}){t||e||Rt('Fixed width files require a "positions" or "widths" option');let n=0;return t||e.map((t=>[n,n+=t]))}(e);return ga((()=>{const t=n();if(t)return r.map((([e,n])=>t.slice(e,n).trim()))}),e.names,e)}function Ea(t){const e=t.length;for(let n=0;n<e;++n){const e=t.charCodeAt(n);if(e<48||e>57)return!1}return!0}function Aa(t,e={}){const n=Ls(e.autoType);V(t)&&(t=JSON.parse(t));let r,s=t.data;if(lt(s)&&!L(s)?t.schema&&t.schema.fields&&(r=t.schema.fields.map((t=>t.name))):s=t,n||e.parse){const t=e.parse||{};for(const e in s){const r=s[e],a=r.length;if(t[e])for(let n=0;n<a;++n)r[n]=t[e](r[n]);else if(n)for(let t=0;t<a;++t){const e=r[t];V(e)&&et(e)&&!Ea(e)&&(r[t]=new Date(e))}}}return new Ws(s,r)}function ja(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:s,minstep:a,step:o,offset:i}=e,u=[r,s,a,o];let c=u.length;for(;c&&null==u[--c];)u.pop();return`d => op.bin(${n}, ...op.bins(${n}${u.length?", "+u.map((t=>t+"")).join(", "):""}), ${i||0})`}function ka(t){return Wn(t,{escape:!0,toString(){Rt("Escaped values can not be serialized.")}})}function Na(t){return Wn(t,{desc:!0})}function Sa(t){return`() => op.round(${+t} * op.count())`}function Oa(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let s=0;s<r;++s)n.set(e.columnName(s),t[s]);return n}}function Ta(t,e,n){return Wn(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function Ca(t,e){return dr(Pr(t),{_:e}).get("_")}const Ia=(t,e)=>Rt(`Illegal ${e} name: ${jt(t)}`),Ua=(t,e)=>Rt(`The ${e} ${jt(t)} is already defined. Use override option?`);function Da(t,e,n,r){return n[t]===e||function(t,e,n=Ft,r="function"){t||Ia(t,r),!e.override&&vt(n,t)&&Ua(t,r)}(t,r)}function Fa(t,e,n,r={}){if(Da(t,e,n,r))return;const[s=0,a=0]=e.param;n[t]=e,Ft[t]=(...e)=>Nt(t,e.slice(0,s),e.slice(s,s+a))}function Ra(t,e,n){Fa(t,e,Gt,n)}function za(t,e,n){Fa(t,e,Jt,n)}function qa(t,e,n={}){1===arguments.length&&(""===(t=(e=t).name)||"anonymous"===t?Rt("Anonymous function provided, please include a name argument."):t===en&&((t,e)=>{Rt(`The ${e} name ${jt(t)} is reserved and can not be overridden.`)})(en,"function")),Da(t,e,$t,n)||($t[t]=e,Ft[t]=e)}function Pa(t,e){const n=e=>Rt(`Illegal argument type: ${e||typeof t}`);return t instanceof Map?Ba(t.entries(),e):ut(t)?n("Date"):ct(t)?n("RegExp"):V(t)?n():q(t)?function(t,e){const n=t.length,r={},s=t=>r[t]=Array(n);if(n){const r=(e=e||Object.keys(t[0])).map(s),a=r.length;for(let s=0;s<n;++s){const n=t[s];for(let t=0;t<a;++t)r[t][s]=n[e[t]]}}else e&&e.forEach(s);return r}(t,e):le(t[Symbol.iterator])?function(t,e){const n={},r=t=>n[t]=[];let s,a;for(const n of t){s||(s=(e=e||Object.keys(n)).map(r),a=s.length);for(let t=0;t<a;++t)s[t].push(n[e[t]])}!s&&e&&e.forEach(r);return n}(t,e):lt(t)?Ba(Object.entries(t),e):n()}function Ba(t,e=["key","value"]){const n=[],r=[];for(const[e,s]of t)n.push(e),r.push(s);const s={};return e[0]&&(s[e[0]]=n),e[1]&&(s[e[1]]=r),s}function La(t,e){if(t instanceof Ws)return t;const n={},r=[];for(const[e,s]of Ke(t))n[e]=s,r.push(e);return new Ws(n,e||r)}function Va(t,e){return new Ws(Pa(t,e),e)}function Ga(t,e={}){const n=e.using||Ma;return fetch(t,e.fetch).then((t=>t[e.as||"text"]())).then((t=>n(t,e)))}function Ha(t,e){return Ga(t,{...e,as:"arrayBuffer",using:ua})}function Wa(t,e){return Ga(t,{...e,as:"text",using:Ma})}function Ja(t,e){return Ga(t,{...e,as:"text",using:$a})}function Ya(t,e){return Ga(t,{...e,as:"json",using:Qa})}function Qa(t,e){return q(t)?Va(t):Aa(t,e)}export{R as BitSet,Ws as ColumnTable,zt as Reducer,yr as Table,Ra as addAggregateFunction,qa as addFunction,za as addWindowFunction,Ca as agg,er as all,ja as bin,Na as desc,or as endswith,ka as escape,Yn as field,Sa as frac,Va as from,ua as fromArrow,Ma as fromCSV,$a as fromFixed,Aa as fromJSON,Ga as load,Ha as loadArrow,Wa as loadCSV,Ja as loadFixed,Ya as loadJSON,sr as matches,Oa as names,nr as not,Ft as op,Gn as parse,rr as range,Ta as rolling,gt as seed,ar as startswith,La as table,Us as toArrow,Ds as toArrowIPC,qs as toCSV,Bs as toHTML,Gs as toJSON,Hs as toMarkdown,Se as walk_ast};export default null;
